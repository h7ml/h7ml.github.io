import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as c,c as i,d as s,e as n,a as t,f as p}from"./app-Cbix2SPG.js";const l={},u=p(`<h1 id="场景" tabindex="-1"><a class="header-anchor" href="#场景"><span>场景</span></a></h1><p>假设我们在开发一款外卖网站，进入网站的时候，第一步需要去请求后端接口得到用户的常用外卖地址。然后再去请求其他接口、渲染页面。如果什么都不考虑可能会直接这样写：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// getAddress 异步请求</span>
<span class="token comment">// 页面里有三个模块 A，B，C 需要拿到地址后再进行下一步</span>
<span class="token comment">// A、B、C 三个模块都是不同人写的，提供了不同的方法供我们调用</span>

<span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> address <span class="token operator">=</span> res<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
  <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">C</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时页面里多了一个模块 <code>D</code> ，同样需要拿到地址后进行下一步操作，我们只好去翻请求地址的代码把 <code>D</code> 模块的调用补上。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// getAddress 异步请求</span>
<span class="token comment">// 页面里有三个模块 A，B，C 需要拿到地址后再进行下一步</span>
<span class="token comment">// A、B、C 三个模块都是不同人写的，提供了不同的方法供我们调用</span>

<span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> address <span class="token operator">=</span> res<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
  <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">C</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">D</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到各个模块和获取地址模块耦合严重，<code>A</code>、<code>B</code>、<code>C</code> 模块有变化或者有新增模块，都需要深入到获取地址的代码去修改，一不小心可能就改出问题了。</p><p>此时就需要观察者模式了。</p><h1 id="观察者模式" tabindex="-1"><a class="header-anchor" href="#观察者模式"><span>观察者模式</span></a></h1>`,8),k={href:"https://en.wikipedia.org/wiki/Observer_pattern#cite_note-5",target:"_blank",rel:"noopener noreferrer"},d=s("strong",null,"observer pattern",-1),r={href:"https://en.wikipedia.org/wiki/Software_design_pattern",target:"_blank",rel:"noopener noreferrer"},v={href:"https://en.wikipedia.org/wiki/Object_(computer_science)#Objects_in_object-oriented_programming",target:"_blank",rel:"noopener noreferrer"},m=s("strong",null,"subject",-1),b=s("strong",null,"observers",-1),g={href:"https://en.wikipedia.org/wiki/Method_(computer_science)",target:"_blank",rel:"noopener noreferrer"},w=p(`<p>很好理解的一个设计模式，有一个 <code>subject</code> 对象，然后有很多 <code>observers</code> 观察者对象，当 <code>subject</code> 对象有变化的时候去通知 <code>observer</code> 对象即可。</p><p>再看一下 <code>UML</code> 图和时序图：</p><figure><img src="http://static.h7ml.cn/vitepress/assets/images/designPattern/windliangblog.oss-cn-beijing.aliyuncs.comimage-20220127110751274.png" alt="image-20220127110751274" tabindex="0" loading="lazy"><figcaption>image-20220127110751274</figcaption></figure><p>每一个观察者都实现了 <code>update</code> 方法，并且调用 <code>Subject</code> 对象的 <code>attach</code> 方法订阅变化。当 <code>Subject</code> 变化时，调用 <code>Observer</code> 的 <code>update</code> 方法去通知观察者。</p><p>先用 <code>java</code> 写一个简单的例子：</p><p>公众号文章可以看作是 <code>Subject</code> ，会不定期更新。然后每一个用户都是一个 <code>Observer</code> ，订阅公众号，当更新的时候就可以第一时间收到消息。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 提取 Subject 的公共部分</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span><span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span><span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
            observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 具体的公众号，提供写文章和得到文章</span>
<span class="token keyword">class</span> <span class="token class-name">WindLiang</span> <span class="token keyword">extends</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> post<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writePost</span><span class="token punctuation">(</span><span class="token class-name">String</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        post <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> post<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 小明</span>
<span class="token keyword">class</span> <span class="token class-name">XiaoMing</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">WindLiang</span> subject<span class="token punctuation">;</span>

    <span class="token class-name">XiaoMing</span><span class="token punctuation">(</span><span class="token class-name">WindLiang</span> sub<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        subject <span class="token operator">=</span> sub<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> post <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">getPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我收到了&quot;</span> <span class="token operator">+</span> post <span class="token operator">+</span> <span class="token string">&quot; 并且点了个赞&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 小杨</span>
<span class="token keyword">class</span> <span class="token class-name">XiaoYang</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">WindLiang</span> subject<span class="token punctuation">;</span>

    <span class="token class-name">XiaoYang</span><span class="token punctuation">(</span><span class="token class-name">WindLiang</span> sub<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        subject <span class="token operator">=</span> sub<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> post <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">getPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我收到了&quot;</span> <span class="token operator">+</span> post <span class="token operator">+</span> <span class="token string">&quot; 并且转发了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 小刚</span>
<span class="token keyword">class</span> <span class="token class-name">XiaoGang</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">WindLiang</span> subject<span class="token punctuation">;</span>

    <span class="token class-name">XiaoGang</span><span class="token punctuation">(</span><span class="token class-name">WindLiang</span> sub<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        subject <span class="token operator">=</span> sub<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> post <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">getPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我收到了&quot;</span> <span class="token operator">+</span> post <span class="token operator">+</span> <span class="token string">&quot; 并且收藏&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WindLiang</span> windliang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WindLiang</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Subject</span>
        <span class="token class-name">XiaoMing</span> xiaoMing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XiaoMing</span><span class="token punctuation">(</span>windliang<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XiaoYang</span> xiaoYang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XiaoYang</span><span class="token punctuation">(</span>windliang<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XiaoGang</span> xiaoGang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XiaoGang</span><span class="token punctuation">(</span>windliang<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 添加观察者</span>
        windliang<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>xiaoMing<span class="token punctuation">)</span><span class="token punctuation">;</span>
        windliang<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>xiaoYang<span class="token punctuation">)</span><span class="token punctuation">;</span>
        windliang<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>xiaoGang<span class="token punctuation">)</span><span class="token punctuation">;</span>

        windliang<span class="token punctuation">.</span><span class="token function">writePost</span><span class="token punctuation">(</span><span class="token string">&quot;新文章-观察者模式，balabala&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新文章</span>
        windliang<span class="token punctuation">.</span><span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通知观察者</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果如下：</p><figure><img src="http://static.h7ml.cn/vitepress/assets/images/designPattern/windliangblog.oss-cn-beijing.aliyuncs.comimage-20220129125814418.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>上边的实现主要是为了符合最原始的定义，调用 <code>update</code> 的时候没有传参。如果观察者需要的参数是一致的，其实这里也可以直接把更新后的数据传过去，这样观察者就不需要向上边一样再去调用 <code>subject.getPost()</code> 手动拿更新后的数据了。</p><p>这两种不同的方式前者叫做拉 <code>(pull)</code> 模式，就是收到 <code>Subject</code> 的通知后，通过内部的 <code>Subject</code> 对象调用相应的方法去拿到需要的数据。</p><p>后者叫做推 <code>(push)</code> 模式，<code>Subject</code> 更新的时候就将数据推给观察者，观察者直接使用即可。</p><p>下边用 <code>js</code> 改写为推模式：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">WindLiang</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> post <span class="token operator">=</span> <span class="token string">&#39;还没更新&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">attach</span><span class="token punctuation">(</span><span class="token parameter">update</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">detach</span><span class="token punctuation">(</span><span class="token parameter">update</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> findIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          findIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>findIndex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>findIndex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">writePost</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      post <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> XiaoMing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;我收到了&#39;</span> <span class="token operator">+</span> post <span class="token operator">+</span> <span class="token string">&#39; 并且点了个赞&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> XiaoYang <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;我收到了&#39;</span> <span class="token operator">+</span> post <span class="token operator">+</span> <span class="token string">&#39; 并且转发了&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> XiaoGang <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;我收到了&#39;</span> <span class="token operator">+</span> post <span class="token operator">+</span> <span class="token string">&#39; 并且收藏&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

windliang <span class="token operator">=</span> <span class="token function">WindLiang</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

windliang<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>XiaoMing<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
windliang<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>XiaoYang<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
windliang<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>XiaoGang<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>

windliang<span class="token punctuation">.</span><span class="token function">writePost</span><span class="token punctuation">(</span><span class="token string">&#39;新文章-观察者模式，balabala&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
windliang<span class="token punctuation">.</span><span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>js</code> 中，我们可以直接将 <code>update</code> 方法传给 <code>Subject</code> ，同时采取推模式，调用 <code>update</code> 的时候直接将数据传给观察者，看起来会简洁很多。</p><h1 id="代码实现" tabindex="-1"><a class="header-anchor" href="#代码实现"><span>代码实现</span></a></h1><p>回到开头的场景，我们可以利用观察者模式将获取地址后的一系列后续操作解耦出来。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 页面里有三个模块 A，B，C 需要拿到地址后再进行下一步</span>
<span class="token comment">// A、B、C 三个模块都是不同人写的，提供了不同的方法供我们调用</span>
<span class="token keyword">const</span> observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 注册观察者</span>
observers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
observers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
obervers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">.</span>change<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// getAddress 异步请求</span>
<span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> address <span class="token operator">=</span> res<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
  observers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">update</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">update</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过观察者模式我们将获取地址后的操作解耦了出来，未来有新增模块只需要注册观察者即可。</p><p>当 <code>getAddress</code> 很复杂的时候，通过观察者模式会使得未来的改动变得清晰，不会影响到 <code>getAddress</code> 的逻辑。</p><p>必要的话也可以把 <code>observers</code> 抽离到一个新的文件作为一个新模块，防止让一个文件变得过于臃肿。</p><h1 id="总" tabindex="-1"><a class="header-anchor" href="#总"><span>总</span></a></h1><p>观察者模式比较好理解，通过抽象出一个 <code>Subject</code> 和多个观察者，减轻了它们之间的过度耦合。再说简单点就是利用回调函数，异步完成后调用传入的回调即可。但上边写的观察者模式还是有一些缺点：</p><ul><li><code>Subject</code> 仍需要自己维护一个观察者列表，进行 <code>push</code> 和 <code>update</code>。</li><li>如果有其他的模块也需要使用观察者模式，还需要模块本身再维护一个新的观察者列表，而不能复用之前的代码。</li><li><code>Subject</code> 需要知道观察者提供了什么方法以便未来的时候进行回调。</li></ul><p>下一篇文章会继续改进上边的写法，观察者模式的本质思想不变（某个对象变化，然后通知其他观察者对象进行更新）。</p><p>但写法上会引入一个中间平台，便于代码更好的复用，使得 <code>Subject</code> 和观察者进行更加彻底的解耦，同时给了它一个新的名字「发布订阅模式」。</p>`,26);function h(f,y){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,s("p",null,[n("可以看下 "),s("a",k,[n("维基百科"),t(a)]),n("的介绍：")]),s("blockquote",null,[s("p",null,[n("The "),d,n(" is a "),s("a",r,[n("software design pattern"),t(a)]),n(" in which an "),s("a",v,[n("object"),t(a)]),n(", named the "),m,n(", maintains a list of its dependents, called "),b,n(", and notifies them automatically of any state changes, usually by calling one of their "),s("a",g,[n("methods"),t(a)]),n(".")])]),w])}const x=e(l,[["render",h],["__file","observer.html.vue"]]),A=JSON.parse('{"path":"/posts/designPattern/observer.html","title":"观察者模式","lang":"zh-CN","frontmatter":{"title":"观察者模式","category":["设计模式","frontend"],"tag":["设计模式","frontend"],"author":"h7ml","image":"https://www.h7ml.cn/logo.png","banner":"https://www.h7ml.cn/logo.png","date":"2022-01-27T09:22:44.000Z","description":"场景 假设我们在开发一款外卖网站，进入网站的时候，第一步需要去请求后端接口得到用户的常用外卖地址。然后再去请求其他接口、渲染页面。如果什么都不考虑可能会直接这样写： 此时页面里多了一个模块 D ，同样需要拿到地址后进行下一步操作，我们只好去翻请求地址的代码把 D 模块的调用补上。 可以看到各个模块和获取地址模块耦合严重，A、B、C 模块有变化或者有新增...","head":[["link",{"rel":"canonical","href":"https://www.h7ml.cn/posts/designPattern/observer.html"}],["meta",{"property":"og:url","content":"https://www.h7ml.cn/posts/designPattern/observer.html"}],["meta",{"property":"og:site_name","content":"h7ml-前端物语"}],["meta",{"property":"og:title","content":"观察者模式"}],["meta",{"property":"og:description","content":"场景 假设我们在开发一款外卖网站，进入网站的时候，第一步需要去请求后端接口得到用户的常用外卖地址。然后再去请求其他接口、渲染页面。如果什么都不考虑可能会直接这样写： 此时页面里多了一个模块 D ，同样需要拿到地址后进行下一步操作，我们只好去翻请求地址的代码把 D 模块的调用补上。 可以看到各个模块和获取地址模块耦合严重，A、B、C 模块有变化或者有新增..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://www.h7ml.cn/logo.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-05-03T04:52:44.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://www.h7ml.cn/logo.png"}],["meta",{"name":"twitter:image:alt","content":"观察者模式"}],["meta",{"property":"article:author","content":"h7ml"}],["meta",{"property":"article:tag","content":"设计模式"}],["meta",{"property":"article:tag","content":"frontend"}],["meta",{"property":"article:published_time","content":"2022-01-27T09:22:44.000Z"}],["meta",{"property":"article:modified_time","content":"2023-05-03T04:52:44.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"观察者模式\\",\\"image\\":[\\"http://static.h7ml.cn/vitepress/assets/images/designPattern/windliangblog.oss-cn-beijing.aliyuncs.comimage-20220127110751274.png\\",\\"http://static.h7ml.cn/vitepress/assets/images/designPattern/windliangblog.oss-cn-beijing.aliyuncs.comimage-20220129125814418.png\\"],\\"datePublished\\":\\"2022-01-27T09:22:44.000Z\\",\\"dateModified\\":\\"2023-05-03T04:52:44.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"h7ml\\"}]}"]]},"headers":[],"git":{"createdTime":1683089564000,"updatedTime":1683089564000,"contributors":[{"name":"h7ml","email":"h7ml@qq.com","commits":1}]},"readingTime":{"minutes":5.79,"words":1738},"filePathRelative":"posts/designPattern/observer.md","localizedDate":"2022年1月27日","excerpt":"\\n<p>假设我们在开发一款外卖网站，进入网站的时候，第一步需要去请求后端接口得到用户的常用外卖地址。然后再去请求其他接口、渲染页面。如果什么都不考虑可能会直接这样写：</p>\\n<div class=\\"language-javascript\\" data-ext=\\"js\\" data-title=\\"js\\"><pre class=\\"language-javascript\\"><code><span class=\\"token comment\\">// getAddress 异步请求</span>\\n<span class=\\"token comment\\">// 页面里有三个模块 A，B，C 需要拿到地址后再进行下一步</span>\\n<span class=\\"token comment\\">// A、B、C 三个模块都是不同人写的，提供了不同的方法供我们调用</span>\\n\\n<span class=\\"token function\\">getAddress</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">res</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n  <span class=\\"token keyword\\">const</span> address <span class=\\"token operator\\">=</span> res<span class=\\"token punctuation\\">.</span>address<span class=\\"token punctuation\\">;</span>\\n  <span class=\\"token constant\\">A</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">update</span><span class=\\"token punctuation\\">(</span>address<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n  <span class=\\"token constant\\">B</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">next</span><span class=\\"token punctuation\\">(</span>address<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n  <span class=\\"token constant\\">C</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">change</span><span class=\\"token punctuation\\">(</span>address<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n</code></pre></div>","autoDesc":true}');export{x as comp,A as data};
