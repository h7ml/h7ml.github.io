import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as t,o as l,c as p,d as n,e as s,a as c,f as e}from"./app-Cbix2SPG.js";const o={},r=e(`<h2 id="配置与应用场景" tabindex="-1"><a class="header-anchor" href="#配置与应用场景"><span>配置与应用场景</span></a></h2><h2 id="域名解析" tabindex="-1"><a class="header-anchor" href="#域名解析"><span>域名解析</span></a></h2><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909095951565.png" alt="image-20220909095951565" tabindex="0" loading="lazy"><figcaption>image-20220909095951565</figcaption></figure><h3 id="浏览器、nginx-与-http-协议" tabindex="-1"><a class="header-anchor" href="#浏览器、nginx-与-http-协议"><span>浏览器、Nginx 与 HTTP 协议</span></a></h3><ul><li>电脑拿到 IP 地址、首先会先发送 TCP/IP 协议（HTTP 或 HTTPS 协议在 TCP/IP 协议之上，TCP/IP 协议只能传输二进制数据）。</li><li>在宽带（电信、联通、移动）的主干网上会进过很多个网关（也可以理解为路由器）。</li><li>从家里的网关=&gt;&gt;小区的网关=&gt;&gt;服务商的网关=&gt;&gt;（电信、联通、移动）的网关=&gt;&gt;区域的网关=&gt;&gt;市里的网关=&gt;&gt;全国的总网关=&gt;&gt;最后才到主干网上。</li><li>HTTPS 就是在这个过程中给你是数据进行了加密。</li></ul><h2 id="虚拟主机的原理" tabindex="-1"><a class="header-anchor" href="#虚拟主机的原理"><span>虚拟主机的原理</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>域名/IP ==&gt; Nginx，访问服务器获取资源

域名/IP &lt;== Nginx, 服务器返回资源
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样的话一台主机就可以给外界公布一个公网 IP，如果公网 IP 只绑定了一个 IP 地址上，这样就有可能会造成<strong>性能过剩</strong>，因为这一台主机不会时时的高访问。</p><p>如果将多个域名绑定到一台主机上，在<strong>通过 Nginx 服务器来判断你访问的是哪一个域名</strong>，之后在返回给你对应的资源</p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909111838691.png" alt="image-20220909111838691" tabindex="0" loading="lazy"><figcaption>image-20220909111838691</figcaption></figure><h3 id="本地域名解析" tabindex="-1"><a class="header-anchor" href="#本地域名解析"><span>本地域名解析</span></a></h3><p>找到本地主机的 hosts 文件 <code>C:\\Windows\\System32\\drivers\\etc</code></p><p>在最后加上：</p><p>IP 地址 域名</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>192.168.88.100 hadoop100.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="公网域名配置与泛域名解析" tabindex="-1"><a class="header-anchor" href="#公网域名配置与泛域名解析"><span>公网域名配置与泛域名解析</span></a></h3><p>首先需要一个域名，购买渠道阿里云、腾讯云，这里已阿里云</p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909131341414.png" alt="image-20220909131341414" tabindex="0" loading="lazy"><figcaption>image-20220909131341414</figcaption></figure><p><strong>主机记录</strong></p>`,19),d=n("li",null,"第一种：指定前缀的，例如 www 之类的。",-1),m={href:"http://gopeak.cn",target:"_blank",rel:"noopener noreferrer"},u=n("code",null,"www.gopeak.cn",-1),g=n("li",null,[s("第三种：填 "),n("code",null,"*"),s("（通配符），这样所有的二级，三级等域名"),n("strong",null,"都会匹配到当前主机上")],-1),v=e(`<p><strong>记录值</strong>：也就是主机名</p><h3 id="配置多个虚拟主机" tabindex="-1"><a class="header-anchor" href="#配置多个虚拟主机"><span>配置多个虚拟主机</span></a></h3><p><strong>域名设置</strong></p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909144630354.png" alt="image-20220909144630354" tabindex="0" loading="lazy"><figcaption>image-20220909144630354</figcaption></figure><p><strong>Nginx 设置</strong></p><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">1</span></span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 虚拟主机 vhost</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 域名 主机名</span>
        <span class="token directive"><span class="token keyword">server_name</span>  www.gopeak.cn</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   /www/www</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 虚拟主机 vhost</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 域名 主机名</span>
        <span class="token directive"><span class="token keyword">server_name</span>  vod.gopeak.cn</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   /www/vodi</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="最小配置" tabindex="-1"><a class="header-anchor" href="#最小配置"><span>最小配置</span></a></h3><h4 id="worker-processes" tabindex="-1"><a class="header-anchor" href="#worker-processes"><span>worker_processes</span></a></h4><ul><li><code>worker_processes 1</code>; 默认为 1，表示<strong>开启一个业务进程</strong></li></ul><h4 id="worker-connections" tabindex="-1"><a class="header-anchor" href="#worker-connections"><span>worker_connections</span></a></h4><ul><li><code>worker_connections 1024</code>; <strong>单个业务</strong>进程可接受连接数</li></ul><h4 id="include-mime-types" tabindex="-1"><a class="header-anchor" href="#include-mime-types"><span>include mime.types</span></a></h4><ul><li><code>include mime.types</code>; 引入<code>http mime</code>类型，<strong>在请求头中标明服务端给客户端返回的文件是什么类型的文件</strong>。</li></ul><h4 id="default-type-application-octet-stream" tabindex="-1"><a class="header-anchor" href="#default-type-application-octet-stream"><span>default_type application/octet-stream</span></a></h4><ul><li><code>default_type application/octet-stream</code>; <strong>如果<code>mime</code>类型没匹配上</strong>，默认使用二进制流的方式传输。</li></ul><h4 id="sendfile-on" tabindex="-1"><a class="header-anchor" href="#sendfile-on"><span>sendfile on</span></a></h4><ul><li><code>sendfile on</code>; 使用<code>linux</code>的 <code>sendfile(socket, file, len)</code> 高效网络传输，也就是数据 0 拷贝。</li></ul><p><strong>未开启<code>sendfile</code></strong></p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907111843362.png" alt="image-20220907111843362" tabindex="0" loading="lazy"><figcaption>image-20220907111843362</figcaption></figure><p><strong>开启<code>sendfile</code>后</strong></p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907111937461.png" alt="image-20220907111937461" tabindex="0" loading="lazy"><figcaption>image-20220907111937461</figcaption></figure><h4 id="keepalive-timeout-65" tabindex="-1"><a class="header-anchor" href="#keepalive-timeout-65"><span>keepalive_timeout 65</span></a></h4><ul><li>keepalive_timeout 65;</li></ul><h4 id="server" tabindex="-1"><a class="header-anchor" href="#server"><span>server</span></a></h4><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907112032197.png" alt="image-20220907112032197" tabindex="0" loading="lazy"><figcaption>image-20220907112032197</figcaption></figure><h3 id="虚拟主机配置" tabindex="-1"><a class="header-anchor" href="#虚拟主机配置"><span>虚拟主机配置</span></a></h3><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>   <span class="token number">80</span></span><span class="token punctuation">;</span> 监听端口号
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span> 主机名、域名

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span> 匹配路径
        <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span> 文件根目录
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span> 默认页名称
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span> 报错编码对应页面
    <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
     <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="虚拟主机" tabindex="-1"><a class="header-anchor" href="#虚拟主机"><span>虚拟主机</span></a></h4><p>原本一台服务器只能对应一个站点，通过虚拟主机技术可以虚拟化成多个站点同时对外提供服务</p><h4 id="servername-匹配规则" tabindex="-1"><a class="header-anchor" href="#servername-匹配规则"><span>servername 匹配规则</span></a></h4><p>我们需要注意的是<code>servername</code>匹配分先后顺序，写在前面的匹配上就不会继续往下匹配了。</p><h4 id="完整匹配" tabindex="-1"><a class="header-anchor" href="#完整匹配"><span>完整匹配</span></a></h4><p>我们可以在同一<code>servername</code>中匹配多个域名</p><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server_name</span> vod.mmban.com www1.mmban.com</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="通配符匹配" tabindex="-1"><a class="header-anchor" href="#通配符匹配"><span>通配符匹配</span></a></h4><h4 id="通配符结束匹配" tabindex="-1"><a class="header-anchor" href="#通配符结束匹配"><span>通配符结束匹配</span></a></h4><h4 id="正则匹配" tabindex="-1"><a class="header-anchor" href="#正则匹配"><span>正则匹配</span></a></h4><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server_name</span> ~^[0-9]+\\.mmban\\.com$</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,38);function h(k,b){const a=t("ExternalLinkIcon");return l(),p("div",null,[r,n("ul",null,[d,n("li",null,[s("第二种：不填，例如我现在的域名是 "),n("a",m,[s("gopeak.cn"),c(a)]),s(" ,也会匹配到 "),u,s("。")]),g]),v])}const w=i(o,[["render",h],["__file","virtualhost.html.vue"]]),y=JSON.parse('{"path":"/posts/nginx/virtualhost.html","title":"配置与应用场景","lang":"zh-CN","frontmatter":{"icon":"nginx","order":3,"date":"2022-03-20T00:00:00.000Z","author":"h7ml","category":"nginx","tag":"nginx","title":"配置与应用场景","description":"配置与应用场景 域名解析 image-20220909095951565image-20220909095951565 浏览器、Nginx 与 HTTP 协议 电脑拿到 IP 地址、首先会先发送 TCP/IP 协议（HTTP 或 HTTPS 协议在 TCP/IP 协议之上，TCP/IP 协议只能传输二进制数据）。 在宽带（电信、联通、移动）的主干网上会...","head":[["link",{"rel":"canonical","href":"https://www.h7ml.cn/posts/nginx/virtualhost.html"}],["meta",{"property":"og:url","content":"https://www.h7ml.cn/posts/nginx/virtualhost.html"}],["meta",{"property":"og:site_name","content":"h7ml-前端物语"}],["meta",{"property":"og:title","content":"配置与应用场景"}],["meta",{"property":"og:description","content":"配置与应用场景 域名解析 image-20220909095951565image-20220909095951565 浏览器、Nginx 与 HTTP 协议 电脑拿到 IP 地址、首先会先发送 TCP/IP 协议（HTTP 或 HTTPS 协议在 TCP/IP 协议之上，TCP/IP 协议只能传输二进制数据）。 在宽带（电信、联通、移动）的主干网上会..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909095951565.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-05-03T04:52:44.000Z"}],["meta",{"property":"article:author","content":"h7ml"}],["meta",{"property":"article:tag","content":"nginx"}],["meta",{"property":"article:published_time","content":"2022-03-20T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-05-03T04:52:44.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"配置与应用场景\\",\\"image\\":[\\"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909095951565.png\\",\\"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909111838691.png\\",\\"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909131341414.png\\",\\"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909144630354.png\\",\\"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907111843362.png\\",\\"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907111937461.png\\",\\"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907112032197.png\\"],\\"datePublished\\":\\"2022-03-20T00:00:00.000Z\\",\\"dateModified\\":\\"2023-05-03T04:52:44.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"h7ml\\"}]}"]]},"headers":[{"level":2,"title":"配置与应用场景","slug":"配置与应用场景","link":"#配置与应用场景","children":[]},{"level":2,"title":"域名解析","slug":"域名解析","link":"#域名解析","children":[{"level":3,"title":"浏览器、Nginx 与 HTTP 协议","slug":"浏览器、nginx-与-http-协议","link":"#浏览器、nginx-与-http-协议","children":[]}]},{"level":2,"title":"虚拟主机的原理","slug":"虚拟主机的原理","link":"#虚拟主机的原理","children":[{"level":3,"title":"本地域名解析","slug":"本地域名解析","link":"#本地域名解析","children":[]},{"level":3,"title":"公网域名配置与泛域名解析","slug":"公网域名配置与泛域名解析","link":"#公网域名配置与泛域名解析","children":[]},{"level":3,"title":"配置多个虚拟主机","slug":"配置多个虚拟主机","link":"#配置多个虚拟主机","children":[]},{"level":3,"title":"最小配置","slug":"最小配置","link":"#最小配置","children":[]},{"level":3,"title":"虚拟主机配置","slug":"虚拟主机配置","link":"#虚拟主机配置","children":[]}]}],"git":{"createdTime":1683089564000,"updatedTime":1683089564000,"contributors":[{"name":"h7ml","email":"h7ml@qq.com","commits":1}]},"readingTime":{"minutes":3.1,"words":930},"filePathRelative":"posts/nginx/virtualhost.md","localizedDate":"2022年3月20日","excerpt":"<h2>配置与应用场景</h2>\\n<h2>域名解析</h2>\\n<figure><img src=\\"https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909095951565.png\\" alt=\\"image-20220909095951565\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>image-20220909095951565</figcaption></figure>\\n<h3>浏览器、Nginx 与 HTTP 协议</h3>\\n<ul>\\n<li>电脑拿到 IP 地址、首先会先发送 TCP/IP 协议（HTTP 或 HTTPS 协议在 TCP/IP 协议之上，TCP/IP 协议只能传输二进制数据）。</li>\\n<li>在宽带（电信、联通、移动）的主干网上会进过很多个网关（也可以理解为路由器）。</li>\\n<li>从家里的网关=&gt;&gt;小区的网关=&gt;&gt;服务商的网关=&gt;&gt;（电信、联通、移动）的网关=&gt;&gt;区域的网关=&gt;&gt;市里的网关=&gt;&gt;全国的总网关=&gt;&gt;最后才到主干网上。</li>\\n<li>HTTPS 就是在这个过程中给你是数据进行了加密。</li>\\n</ul>","autoDesc":true}');export{w as comp,y as data};
