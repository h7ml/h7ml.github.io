<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.32" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="canonical" href="https://www.h7ml.cn/posts/graphics/konva.html"><meta property="og:url" content="https://www.h7ml.cn/posts/graphics/konva.html"><meta property="og:site_name" content="h7ml-å‰ç«¯ç‰©è¯­"><meta property="og:title" content="konva"><meta property="og:description" content="konva å‰è¨€ ç”¨è¿‡ Canvas çš„éƒ½çŸ¥é“å®ƒçš„ API æ¯”è¾ƒå¤šï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆéº»çƒ¦ï¼Œæ¯”å¦‚æˆ‘æƒ³ç»˜åˆ¶ä¸€ä¸ªåœ†å½¢å°±è¦è°ƒä¸€å † APIï¼Œå¯¹å¼€å‘ç®—ä¸ä¸Šå‹å¥½ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹ï¼Œè¯ç”Ÿäº†ä¾‹å¦‚ PIXIã€ZRenderã€Fabric ç­‰ Canvas åº“ã€‚ä»Šå¤©è¦è®²çš„ Konva ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆä¼˜ç§€çš„ Canvas æ¡†æ¶ï¼ŒAPI å°è£…ç®€æ´æ˜“æ‡‚ï¼ŒåŸºäº TypeScript å®ç°..."><meta property="og:type" content="article"><meta property="og:image" content="https://camo.githubusercontent.com/f9afa6e7475eb6ffdf610aeae294ab6678a51e1a45ef71b05e2f583c1f0144f1/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f36373130386631382d303239312d346138312d613336312d3735653565626462366539642e706e67"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-05-03T04:52:44.000Z"><meta property="article:author" content="h7ml"><meta property="article:tag" content="graphics"><meta property="article:published_time" content="2021-01-17T00:00:00.000Z"><meta property="article:modified_time" content="2023-05-03T04:52:44.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"konva","image":["https://camo.githubusercontent.com/f9afa6e7475eb6ffdf610aeae294ab6678a51e1a45ef71b05e2f583c1f0144f1/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f36373130386631382d303239312d346138312d613336312d3735653565626462366539642e706e67","https://camo.githubusercontent.com/29a78d23111ca442579c11ed9c56d8d8f50288dcf9e99bc6128e0a8de0470f71/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f34333435323935312d386131372d343665642d613136302d6563343065393234396132322e706e67","https://camo.githubusercontent.com/4828d368c32e74643cbb46d198154e8d11830dc3610a082b9eca3f624f09449f/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f30343531323865362d303637332d343535662d383739302d6335336437346365353662622e706e67","https://camo.githubusercontent.com/5aa09e0b1727de6052f80f44d0dd13736059acfe0e84bb681cb09cc4f4d01ec5/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f63613061646131612d613263322d343363322d626262362d3534353264323365343534362e706e67","https://camo.githubusercontent.com/b9b5d26a9416879dc1be928551640eba483b5af33a0af809def5f2b2fc6a5fea/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f32393861326332322d363837332d343464352d393234662d3331306461343239313931302e706e67","https://camo.githubusercontent.com/a462a32aa3f2bf7f01f52a225069d66a35b7ffbb9de0320ec7bfabb81a21b2e0/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f34663139613934392d303035372d346434632d393032342d3561633637373838663239382e706e67","https://camo.githubusercontent.com/56f41e90923fd22589829ba27314071b45fccabf3584bd84fef6096769120833/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f33353666323635322d663831332d343434362d393265612d3563383735363035303631342e706e67","https://camo.githubusercontent.com/e975ab71150c628666949ce3803e1e6d50e6045bd370850de3e2ae65f495aa20/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f36396264363065342d306335302d346465662d613564372d3665303531393761323663392e706e67","https://camo.githubusercontent.com/352ea8233908db8e9464a7b814deb15ebf770b61c171ca4067da513109f29deb/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f35333735653761642d393835332d343236302d613265312d6631633263643738366662642e706e67","https://camo.githubusercontent.com/821609f511a6cd1760042d9fea1d66ce53deabed1e2628df0683b73e898cba16/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f62376437653336382d643833622d343765342d613234382d3734613732306133656665632e706e67","https://camo.githubusercontent.com/5736b6469b94b56d537b2a76c8999e3b307278d42527a4bb7f4d87f2b68357cd/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f39346434613735622d626262362d343861312d623036302d6165376530386164626130382e706e67","https://camo.githubusercontent.com/695f54a7f71577ec66604e45270bc623eabb928e823bcce2b564d636de17997a/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f64333463333963632d386464312d346239382d613933332d6533633338303164643739332e706e67","https://camo.githubusercontent.com/0c8f0933195af9f1afa41f3f2a373158a101454f3c36c8a585eee32337a9f33c/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f63616536613739652d623937312d343238392d393432652d6536303539366537303432362e706e67"],"datePublished":"2021-01-17T00:00:00.000Z","dateModified":"2023-05-03T04:52:44.000Z","author":[{"@type":"Person","name":"h7ml"}]}</script><meta name="keywords" content="å‰ç«¯ç‰©è¯­ã€h7mlåšå®¢ã€VuePressã€JavaScriptã€CSSã€HTML5ã€MySQLã€Dockerã€Redisã€Nginxã€Pythonã€Goã€PHP"><meta name="description" content="h7mlæ˜¯ä¸€ä¸ªä¸“æ³¨äºå‰ç«¯ç‰©è¯­çš„VuePressåšå®¢ï¼Œè‡´åŠ›äºåˆ†äº«å‰ç«¯å¼€å‘çš„æŠ€æœ¯å’Œç»éªŒã€‚æˆ‘ä»¬æ¶µç›–äº†JavaScriptã€CSSã€HTML5ã€MySQLç­‰å¤šä¸ªæ–¹é¢çš„ç¼–ç¨‹å®è·µå’Œå­¦ä¹ ç¬”è®°ï¼Œæ—¨åœ¨å¸®åŠ©å‰ç«¯å¼€å‘è€…æé«˜æŠ€èƒ½æ°´å¹³å’Œè§£å†³å®é™…é—®é¢˜ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¼€æºäº†å¤šä¸ªé¡¹ç›®ï¼Œæ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºï¼Œä¸€èµ·æ¢ç´¢å‰ç«¯å¼€å‘çš„ä¸–ç•Œï¼"><meta name="baidu-site-verification" content="code-Lp1igULfj7"><meta name="sogou_site_verification" content="BWYVlXjMMm"><meta name="shenma-site-verification" content="ee99e8921fe7309289e832fd8b02b3c4_1675848238"><meta name="360-site-verification" content="d429aed2ee74fc7e9fd3e2321ce178a7"><meta name="google-site-verification" content="aY4x14jxZErrVd-FCPVQDhEjk9A_kKf9Cav8QDDVi98"><meta name="X-UA-Compatible" content="X-UA-Compatible"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><link type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/zui/1.8.1/css/zui.min.css"><script src="https://hm.baidu.com/hm.js?35afc12d4ac49f5dd49db387044b8cd0"></script><script src="http://code.jquery.com/jquery-1.11.0.min.js"></script><script src="//www.h7ml.cn/js/nav.js"></script><script defer data-cf-beacon="{"token": "911315c7f2124900844d4c0ae0249528"}" src="https://static.cloudflareinsights.com/beacon.min.js"></script><script defer data-cf-beacon="{"token": "f3347d2b3600448fbb01c0db81477724"}" src="https://static.cloudflareinsights.com/beacon.min.js"></script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js?id=JztvXshEfC72l41d&ck=JztvXshEfC72l41d&autoTrack=true&hashMode=true"></script><script crossorigin="anonymous" src="https://sdk.51.la/perf/js-sdk-perf.min.js"></script><script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JztvXshEfC72l41d/quote.js?theme=2&f=12&display=0,1,1,1,1,1,1,1"></script><link rel="alternate" type="application/atom+xml" href="https://www.h7ml.cn/atom.xml" title="h7ml-å‰ç«¯ç‰©è¯­ Atom Feed"><link rel="alternate" type="application/json" href="https://www.h7ml.cn/feed.json" title="h7ml-å‰ç«¯ç‰©è¯­ JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://www.h7ml.cn/rss.xml" title="h7ml-å‰ç«¯ç‰©è¯­ RSS Feed"><title>konva | h7ml-å‰ç«¯ç‰©è¯­</title>
    <link rel="preload" href="/assets/style-C_yFhrBP.css" as="style"><link rel="stylesheet" href="/assets/style-C_yFhrBP.css">
    <link rel="modulepreload" href="/assets/app-Cbix2SPG.js"><link rel="modulepreload" href="/assets/konva.html-DiujZYZT.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">h7ml-å‰ç«¯ç‰©è¯­</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="å‰ç«¯ç‰©è¯­"><span class="font-icon icon iconfont icon-home" style=""></span>å‰ç«¯ç‰©è¯­<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="å‰ç«¯åšæ–‡"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>å‰ç«¯åšæ–‡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/posts/interview/" aria-label="é¢è¯•ç‰©è¯­"><span class="font-icon icon iconfont icon-diagram" style=""></span>é¢è¯•ç‰©è¯­<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/designPattern/" aria-label="è®¾è®¡æ¨¡å¼"><span class="font-icon icon iconfont icon-diagram" style=""></span>è®¾è®¡æ¨¡å¼<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/mysql/" aria-label="mysql"><span class="font-icon icon iconfont icon-mysql" style=""></span>mysql<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/PostgreSQL/" aria-label="PostgreSQL"><span class="font-icon icon iconfont icon-workingDirectory" style=""></span>PostgreSQL<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/Nestjs/" aria-label="Nestjs"><span class="font-icon icon iconfont icon-generic" style=""></span>Nestjs<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/docker/" aria-label="docker"><span class="font-icon icon iconfont icon-box" style=""></span>docker<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/rxjava/" aria-label="rxjava"><span class="font-icon icon iconfont icon-java" style=""></span>rxjava<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/redis/" aria-label="redis"><span class="font-icon icon iconfont icon-app" style=""></span>redis<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/javascript/" aria-label="javascript"><span class="font-icon icon iconfont icon-javascript" style=""></span>javascript<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/ecmascript/" aria-label="ecmascript6"><span class="font-icon icon iconfont icon-workingDirectory" style=""></span>ecmascript6<!----></a></li><li class="dropdown-item"><a class="route-link nav-link active" href="/posts/graphics/" aria-label="å›¾å½¢å­¦"><span class="font-icon icon iconfont icon-card" style=""></span>å›¾å½¢å­¦<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/git.html" aria-label="Git"><span class="font-icon icon iconfont icon-git" style=""></span>Git<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/es6.html" aria-label="es6"><span class="font-icon icon iconfont icon-direction" style=""></span>es6<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/github/" aria-label="github"><span class="font-icon icon iconfont icon-github" style=""></span>github<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/engineering/" aria-label="å·¥ç¨‹åŒ–"><span class="font-icon icon iconfont icon-proposal" style=""></span>å·¥ç¨‹åŒ–<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/vue/" aria-label="vue"><span class="font-icon icon iconfont icon-vue" style=""></span>vue<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/vite/" aria-label="vite"><span class="font-icon icon iconfont icon-vue" style=""></span>vite<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/react/" aria-label="react"><span class="font-icon icon iconfont icon-react" style=""></span>react<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/linux/" aria-label="linux"><span class="font-icon icon iconfont icon-linux" style=""></span>linux<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/nginx/" aria-label="nginx"><span class="font-icon icon iconfont icon-nginx" style=""></span>nginx<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/navicat/" aria-label="navicat"><span class="font-icon icon iconfont icon-navigate" style=""></span>navicat<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/python/" aria-label="python"><span class="font-icon icon iconfont icon-python" style=""></span>python<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/posts/Pdf/" aria-label="PDF"><span class="font-icon icon iconfont icon-PDF" style=""></span>PDF<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="å‰ç«¯å·¥å…·"><span class="title"><span class="font-icon icon iconfont icon-tool" style=""></span>å‰ç«¯å·¥å…·</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="https://ChatGpt.h7ml.cn?q=h7ml.cn" rel="noopener noreferrer" target="_blank" aria-label="ChatGpt" class="nav-link"><span class="font-icon icon iconfont icon-module" style=""></span>ChatGpt<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-item"><a href="https://ide.h7ml.cn?q=h7ml" rel="noopener noreferrer" target="_blank" aria-label="Web Ide" class="nav-link"><span class="font-icon icon iconfont icon-light" style=""></span>Web Ide<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-item"><a href="https://www.h7ml.cn/nav.html" rel="noopener noreferrer" target="_blank" aria-label="Web Nav" class="nav-link"><span class="font-icon icon iconfont icon-navbar" style=""></span>Web Nav<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/h7ml/h7ml" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon iconfont icon-note" style=""></span><span class="vp-sidebar-title">æ–‡ç« </span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/es6.html" aria-label="es6"><span class="font-icon icon iconfont icon-direction" style=""></span>es6<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/git.html" aria-label="Git"><span class="font-icon icon iconfont icon-git" style=""></span>Git<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-github" style=""></span><span class="vp-sidebar-title">github</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-javascript" style=""></span><span class="vp-sidebar-title">javascript</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-mysql" style=""></span><span class="vp-sidebar-title">mysql</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-pdf" style=""></span><span class="vp-sidebar-title">å‰ç«¯ç‰©è¯­|é¢è¯•ç‰©è¯­-pdf</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/module.html" aria-label="æ¨¡å—åŒ–"><span class="font-icon icon iconfont icon-module" style=""></span>æ¨¡å—åŒ–<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/browser.html" aria-label="æµè§ˆå™¨çŸ¥è¯†"><span class="font-icon icon iconfont icon-chrome" style=""></span>æµè§ˆå™¨çŸ¥è¯†<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-diagram" style=""></span><span class="vp-sidebar-title">è®¾è®¡æ¨¡å¼</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-diagram" style=""></span><span class="vp-sidebar-title">é¢è¯•ç‰©è¯­</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-box" style=""></span><span class="vp-sidebar-title">docker</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-box" style=""></span><span class="vp-sidebar-title">redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-box" style=""></span><span class="vp-sidebar-title">rxjava</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-card" style=""></span><span class="vp-sidebar-title">å›¾å½¢å­¦</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/graphics/svg.html" aria-label="svg"><span class="font-icon icon iconfont icon-card" style=""></span>svg<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/graphics/canvas.html" aria-label="canvas"><span class="font-icon icon iconfont icon-card" style=""></span>canvas<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/graphics/webgl.html" aria-label="webgl"><span class="font-icon icon iconfont icon-card" style=""></span>webgl<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/graphics/erharts.html" aria-label="erharts"><span class="font-icon icon iconfont icon-card" style=""></span>erharts<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/graphics/baiduMap.html" aria-label="baiduMap"><span class="font-icon icon iconfont icon-card" style=""></span>baiduMap<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/graphics/openlayers.html" aria-label="openlayers"><span class="font-icon icon iconfont icon-card" style=""></span>openlayers<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/graphics/three.html" aria-label="three"><span class="font-icon icon iconfont icon-card" style=""></span>three<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/graphics/fabric.html" aria-label="fabric"><span class="font-icon icon iconfont icon-card" style=""></span>fabric<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/posts/graphics/konva.html" aria-label="konva"><span class="font-icon icon iconfont icon-card" style=""></span>konva<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-proposal" style=""></span><span class="vp-sidebar-title">å·¥ç¨‹åŒ–</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/js-engine.html" aria-label="å‰ç«¯ç‰©è¯­|å¦‚ä½•ç¼–å†™JavaScriptå¼•æ“ï¼Ÿ"><span class="font-icon icon iconfont icon-question" style=""></span>å‰ç«¯ç‰©è¯­|å¦‚ä½•ç¼–å†™JavaScriptå¼•æ“ï¼Ÿ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-vue" style=""></span><span class="vp-sidebar-title">vue</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-vue" style=""></span><span class="vp-sidebar-title">vite</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-react" style=""></span><span class="vp-sidebar-title">react</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-nginx" style=""></span><span class="vp-sidebar-title">nginx</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-python" style=""></span><span class="vp-sidebar-title">python</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Apple</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Banana</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Coding</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Ecmascript</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Full Stack Tale</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Html</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-linux" style=""></span><span class="vp-sidebar-title">Linux åŸºç¡€æ“ä½œ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-navigate" style=""></span><span class="vp-sidebar-title">navicat</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-generic" style=""></span><span class="vp-sidebar-title">Nestjs</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-workingDirectory" style=""></span><span class="vp-sidebar-title">PostgreSQLçš„è¯­æ³•çŸ¥è¯†å’Œå¸¸è§æŸ¥è¯¢æ“ä½œ</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/cherry.html" aria-label="æ¨±æ¡ƒ"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>æ¨±æ¡ƒ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/dragonfruit.html" aria-label="ç«é¾™æœ"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>ç«é¾™æœ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/tomato.html" aria-label="ç•ªèŒ„"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>ç•ªèŒ„<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/posts/strawberry.html" aria-label="è‰è“"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>è‰è“<!----></a></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-card" style=""></span>konva</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">h7ml</span></span><span property="author" content="h7ml"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2021-01-17T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 17 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT17M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category4 clickable" role="navigation">graphics</span><!--]--><meta property="articleSection" content="graphics"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag4 clickable" role="navigation">graphics</span><!--]--><meta property="keywords" content="graphics"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å‰è¨€">å‰è¨€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ¶æ„è®¾è®¡">æ¶æ„è®¾è®¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#konva-tree">Konva Tree</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#build-dom">build dom</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ¸²æŸ“">æ¸²æŸ“</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ‰¹é‡æ¸²æŸ“">æ‰¹é‡æ¸²æŸ“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#shape-ç»˜åˆ¶">Shape ç»˜åˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¦»å±æ¸²æŸ“">ç¦»å±æ¸²æŸ“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#perfectdrawenabled">perfectDrawEnabled</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äº‹ä»¶">äº‹ä»¶</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶åˆ†å‘">äº‹ä»¶åˆ†å‘</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŒ¹é…-shape">åŒ¹é… Shape</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è‡ªå®šä¹‰-hitfunc">è‡ªå®šä¹‰ hitFunc</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ‹–æ‹½äº‹ä»¶">æ‹–æ‹½äº‹ä»¶</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ»¤é•œ">æ»¤é•œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#é€‰æ‹©å™¨">é€‰æ‹©å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åºåˆ—åŒ–">åºåˆ—åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#react">React</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#react-reconciler">react-reconciler</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#react-konva">react-konva</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#vue-konva">vue-konva</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¼ºé™·">ç¼ºé™·</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è„çŸ©å½¢">è„çŸ©å½¢</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="konva" tabindex="-1"><a class="header-anchor" href="#konva"><span>konva</span></a></h1><h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€"><span>å‰è¨€</span></a></h2><p>ç”¨è¿‡ Canvas çš„éƒ½çŸ¥é“å®ƒçš„ API æ¯”è¾ƒå¤šï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆéº»çƒ¦ï¼Œæ¯”å¦‚æˆ‘æƒ³ç»˜åˆ¶ä¸€ä¸ªåœ†å½¢å°±è¦è°ƒä¸€å † APIï¼Œå¯¹å¼€å‘ç®—ä¸ä¸Šå‹å¥½ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è®¾ç½®å­—ä½“æ ·å¼</span>
context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&#39;24px SimSun, Songti SC&#39;</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">&#39;24pxçš„å®‹ä½“å‘ˆç°&#39;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ç»˜åˆ¶å®Œæ•´åœ†</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;RGB(255, 0, 0)&#39;</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹ï¼Œè¯ç”Ÿäº†ä¾‹å¦‚ PIXIã€ZRenderã€Fabric ç­‰ Canvas åº“ã€‚ä»Šå¤©è¦è®²çš„ Konva ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆä¼˜ç§€çš„ Canvas æ¡†æ¶ï¼ŒAPI å°è£…ç®€æ´æ˜“æ‡‚ï¼ŒåŸºäº TypeScript å®ç°ï¼Œæœ‰ React å’Œ Vue ç‰ˆæœ¬ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> stage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Konva<span class="token punctuation">.</span>Stage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> layer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Konva<span class="token punctuation">.</span>Layer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Konva<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Konva<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;Hello, this is some good text&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> circle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Konva<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> stage<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> stage<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">radius</span><span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span>
  <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">strokeWidth</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>circle<span class="token punctuation">)</span><span class="token punctuation">;</span>
layer<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
stage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ¶æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#æ¶æ„è®¾è®¡"><span>æ¶æ„è®¾è®¡</span></a></h2><h3 id="konva-tree" tabindex="-1"><a class="header-anchor" href="#konva-tree"><span>Konva Tree</span></a></h3><p>ä»å‰è¨€é‡Œé¢ç»™çš„é‚£æ®µä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼ŒKonva æœ‰ä¸€å®šçš„åµŒå¥—ç»“æ„ï¼Œæœ‰äº›ç±»ä¼¼ DOM ç»“æ„ã€‚é€šè¿‡ add å’Œ remove å°±èƒ½å®ç°å­èŠ‚ç‚¹çš„æ·»åŠ å’Œåˆ é™¤ã€‚ <img src="https://camo.githubusercontent.com/f9afa6e7475eb6ffdf610aeae294ab6678a51e1a45ef71b05e2f583c1f0144f1/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f36373130386631382d303239312d346138312d613336312d3735653565626462366539642e706e67" alt="" loading="lazy"> Konva Tree ä¸»è¦åŒ…æ‹¬è¿™ä¹ˆå‡ éƒ¨åˆ†ï¼š</p><ol><li>Stage æ ¹èŠ‚ç‚¹ï¼šè¿™æ˜¯åº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼Œä¼šåˆ›å»ºä¸€ä¸ª div èŠ‚ç‚¹ï¼Œä½œä¸ºäº‹ä»¶çš„æ¥æ”¶å±‚ï¼Œæ ¹æ®äº‹ä»¶è§¦å‘æ—¶çš„åæ ‡æ¥åˆ†å‘å‡ºå»ã€‚ä¸€ä¸ª Stage èŠ‚ç‚¹å¯ä»¥åŒ…å«å¤šä¸ª Layer å›¾å±‚ã€‚</li><li>Layer å›¾å±‚ï¼šLayer é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ª Canvas èŠ‚ç‚¹ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯ç»˜åˆ¶ Canvas é‡Œé¢çš„å…ƒç´ ã€‚ä¸€ä¸ª Layer å¯ä»¥åŒ…å«å¤šä¸ª Group å’Œ Shapeã€‚</li><li>Group ç»„ï¼šGroup åŒ…å«å¤šä¸ª Shapeï¼Œå¦‚æœå¯¹å…¶è¿›è¡Œå˜æ¢å’Œæ»¤é•œï¼Œé‡Œé¢æ‰€æœ‰çš„ Shape éƒ½ä¼šç”Ÿæ•ˆã€‚</li><li>Shapeï¼šæŒ‡ Textã€Rectã€Circle ç­‰å›¾å½¢ï¼Œè¿™äº›æ˜¯ Konva å°è£…å¥½çš„ç±»ã€‚ <img src="https://camo.githubusercontent.com/29a78d23111ca442579c11ed9c56d8d8f50288dcf9e99bc6128e0a8de0470f71/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f34333435323935312d386131372d343665642d613136302d6563343065393234396132322e706e67" alt="" loading="lazy"></li></ol><h3 id="build-dom" tabindex="-1"><a class="header-anchor" href="#build-dom"><span>build dom</span></a></h3><p>Stage åˆ›å»ºçš„æ—¶å€™ä¼šå»åˆ›å»ºä¸¤ä¸ª Canvas èŠ‚ç‚¹ä»¥åŠ content å®¹å™¨èŠ‚ç‚¹ï¼Œè¿™ä¸¤ä¸ª Canvas èŠ‚ç‚¹æ˜¯ç”¨äº perfectDrawEnabled çš„ï¼Œåé¢ä¼šè®²åˆ°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯è¿™ä¸ª content èŠ‚ç‚¹ï¼Œä½œä¸ºæ•´ä¸ª Konva ç”»å¸ƒçš„å®¹å™¨ï¼Œä¹‹åçš„ Layer éƒ½ä¼šè¢« append è¿›å»ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">_buildDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bufferCanvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SceneCanvas</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bufferHitCanvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HitCanvas</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">pixelRatio</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Konva<span class="token punctuation">.</span>isBrowser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> container <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>container<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token string">&#39;Stage has no container. A container is required.&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// clear content inside container</span>
    container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>

    <span class="token comment">// content</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">&#39;relative&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>style<span class="token punctuation">.</span>userSelect <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&#39;konvajs-content&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;presentation&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_resizeDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è°ƒç”¨ Stage.add çš„æ—¶å€™ï¼Œä¸ä»…ä¼šè°ƒç”¨ Layer çš„ç»˜åˆ¶æ–¹æ³•ï¼Œè¿˜ä¼šæŠŠ Layer çš„ Canvas èŠ‚ç‚¹ append è¿›å»ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">layer</span><span class="token operator">:</span> Layer<span class="token punctuation">,</span> <span class="token operator">...</span>rest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token constant">MAX_LAYERS_NUMBER</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Util<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">&#39;The stage has &#39;</span> <span class="token operator">+</span>
          length <span class="token operator">+</span>
          <span class="token string">&#39; layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group.&#39;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    layer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// draw layer and append canvas to container</span>
    layer<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Konva<span class="token punctuation">.</span>isBrowser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>_canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// chainable</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#æ¸²æŸ“"><span>æ¸²æŸ“</span></a></h2><h3 id="æ‰¹é‡æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#æ‰¹é‡æ¸²æŸ“"><span>æ‰¹é‡æ¸²æŸ“</span></a></h3><p>ä»å‰é¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰æ‰‹åŠ¨è°ƒç”¨ç»˜åˆ¶æ–¹æ³•ï¼Œä½†ä¾ç„¶ä¼šè¿›è¡Œç»˜åˆ¶ï¼Œè¯´æ˜ä¼šåœ¨ä¸€å®šçš„æ—¶æœºè¿›è¡Œæ¸²æŸ“ã€‚ è¿™ä¸ªæ—¶æœºå°±åœ¨ add æ–¹æ³•é‡Œé¢ï¼Œä¸ç®¡ Groupã€Layerã€Stage å“ªä¸ªå…ˆ addï¼Œæœ€ç»ˆéƒ½ä¼šè§¦å‘æ¸²æŸ“ã€‚ä»–ä»¬ä¸‰ä¸ªéƒ½ç»§æ‰¿äº† Container ç±»ï¼Œåœ¨ Container ç±»é‡Œé¢æœ‰ä¸€ä¸ª add æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>children<span class="token operator">:</span> ChildType<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœè¦æ·»åŠ çš„å­èŠ‚ç‚¹å·²ç»æœ‰ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œé‚£å°±å…ˆå°†å…¶ä»çˆ¶èŠ‚ç‚¹ç§»é™¤ï¼Œå†æ’å…¥åˆ°å½“å‰èŠ‚ç‚¹é‡Œé¢</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      child<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_validateAdd</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¾ç½®å­èŠ‚ç‚¹çš„ index å’Œ parent</span>
    child<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    child<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    child<span class="token punctuation">.</span><span class="token function">_clearCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_fire</span><span class="token punctuation">(</span><span class="token string">&#39;add&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">child</span><span class="token operator">:</span> child<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¯·æ±‚ç»˜åˆ¶</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_requestDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é™¤äº†ä¸€äº›å¸¸è§„çš„å¤„ç†ä¹‹å¤–ï¼Œæ¸²æŸ“çš„å…³é”®å°±åœ¨ <code>_requestDraw</code> æ–¹æ³•é‡Œé¢ã€‚è¿™é‡Œè°ƒç”¨äº† Layer ä¸Šé¢çš„ <code>batchDraw</code> è¿›è¡Œæ‰¹é‡é‡ç»˜ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">_requestDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Konva<span class="token punctuation">.</span>autoDrawEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> drawNode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      drawNode<span class="token operator">?.</span><span class="token function">batchDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ‰¹é‡é‡ç»˜çš„åŸç†æ˜¯åˆ©ç”¨ requestAnimationFrame æ–¹æ³•å°†è¦ç»˜åˆ¶çš„å†…å®¹æ”¾åˆ°ä¸‹ä¸€å¸§æ¥ç»˜åˆ¶ã€‚è¿™æ ·åŒæ—¶ä¿®æ”¹å¤šä¸ªå›¾å½¢å¤šä¸ªå±æ€§å°±ä¸éœ€è¦åå¤ç»˜åˆ¶äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">batchDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// _waitingForDraw ä¿è¯åªä¼šæ‰§è¡Œä¸€æ¬¡ requestAnimFrame</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_waitingForDraw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_waitingForDraw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token comment">// å¦‚æœè°ƒç”¨å¤šæ¬¡æ–¹æ³•ä¿®æ”¹ Shape å±æ€§ï¼Œè¿™é‡Œå°±ä¼šæ‰¹é‡ç»˜åˆ¶</span>
      <span class="token comment">// é¿å…äº†å¤šæ¬¡ç»˜åˆ¶å¸¦æ¥çš„å¼€é”€</span>
      Util<span class="token punctuation">.</span><span class="token function">requestAnimFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_waitingForDraw <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shape-ç»˜åˆ¶" tabindex="-1"><a class="header-anchor" href="#shape-ç»˜åˆ¶"><span>Shape ç»˜åˆ¶</span></a></h3><p>æ‰€æœ‰æ¶‰åŠåˆ°å›¾å½¢ç»˜åˆ¶çš„åœ°æ–¹éƒ½æ˜¯è°ƒç”¨ Shape å®ç°ç±»ä¸Šçš„ <code>_sceneFunc</code> æ–¹æ³•ï¼Œä»¥ Circle ä¸ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">_sceneFunc</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>radius <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">fillStrokeShape</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Shape å’Œ Node ä¸¤ä¸ªåŸºç±»ä¸Šé¢åªè´Ÿè´£è°ƒç”¨ï¼Œå…·ä½“çš„å®ç°æ”¾åˆ°å…·ä½“çš„ Shape å®ç°ä¸Šé¢ã€‚è¿™æ ·å¸¦æ¥ä¸¤ä¸ªå¥½å¤„ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥å®ç°è‡ªå®šä¹‰å›¾å½¢ï¼Œå¦ä¸€ä¸ªæ˜¯ä»¥åè¦æ˜¯æ”¯æŒ SVGã€WebGL ä¼šå¾ˆæ–¹ä¾¿ã€‚</p><h3 id="ç¦»å±æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#ç¦»å±æ¸²æŸ“"><span>ç¦»å±æ¸²æŸ“</span></a></h3><p>ä»€ä¹ˆæ˜¯ç¦»å±æ¸²æŸ“ï¼Ÿå°±æ˜¯åœ¨å±å¹•ä¹‹å¤–é¢„æ¸²æŸ“ä¸€ä¸ª Canvasï¼Œä¹‹åé€šè¿‡ drawImage çš„å½¢å¼å°†å…¶ç»˜åˆ¶åˆ°å±å¹•è¦æ˜¾ç¤ºçš„ Canvas ä¸Šé¢ï¼Œå¯¹å½¢çŠ¶ç›¸ä¼¼æˆ–è€…é‡å¤çš„å¯¹è±¡ç»˜åˆ¶æ€§èƒ½æå‡éå¸¸é«˜ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸ªåˆ—è¡¨é¡µï¼Œæ¯æ¬¡æ»šåŠ¨çš„æ—¶å€™å…¨éƒ¨é‡æ–°ç»˜åˆ¶å¼€é”€ä¼šæ¯”è¾ƒå¤§ã€‚ä½†å¦‚æœæˆ‘ä»¬å®ç°ä¸€ä¸ª Canvas æ± ï¼ŒæŠŠå·²ç»ç»˜åˆ¶è¿‡çš„åˆ—è¡¨é¡¹å­˜èµ·æ¥ã€‚ä¸‹æ¬¡æ»šåŠ¨åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥ä» Canvas æ± é‡Œé¢å–å‡ºæ¥ drawImage åˆ°é¡µé¢ä¸Šäº†ã€‚åœ¨ Node ç±»ä¸Šé¢æœ‰ä¸ª cache æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å®ç°ç»†ç²’åº¦çš„ç¦»å±æ¸²æŸ“ã€‚ cache æ–¹æ³•å†…éƒ¨ä¼šåˆ›å»ºä¸‰ä¸ª canvasï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol><li>cachedSceneCanvasï¼šç”¨äºç»˜åˆ¶å›¾å½¢çš„ canvas çš„ç¦»å±æ¸²æŸ“ã€‚</li><li>cachedFilterCanvasï¼šç”¨äºå¤„ç†æ»¤é•œæ•ˆæœã€‚</li><li>cachedHitCanvasï¼šç”¨äºå¤„ç† hitCanvas çš„ç¦»å±æ¸²æŸ“ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">_drawCachedSceneCanvas</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">context</span><span class="token operator">:</span> Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">_applyOpacity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">_applyGlobalCompositeOperation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–ç¦»å±çš„ Canvas</span>
    <span class="token keyword">const</span> canvasCache <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getCanvasCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>canvasCache<span class="token punctuation">.</span>x<span class="token punctuation">,</span> canvasCache<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> cacheCanvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getCachedSceneCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ratio <span class="token operator">=</span> cacheCanvas<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">;</span>
    <span class="token comment">// å°†ç¦»å± Canvas ç»˜åˆ¶åˆ°è¦å±•ç¤ºçš„ Canvas ä¸Šé¢</span>
    context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
      cacheCanvas<span class="token punctuation">.</span>_canvas<span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      cacheCanvas<span class="token punctuation">.</span>width <span class="token operator">/</span> ratio<span class="token punctuation">,</span>
      cacheCanvas<span class="token punctuation">.</span>height <span class="token operator">/</span> ratio
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="perfectdrawenabled" tabindex="-1"><a class="header-anchor" href="#perfectdrawenabled"><span>perfectDrawEnabled</span></a></h3><p>Canvas åœ¨ç»˜åˆ¶ stroke å’Œ fill çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°é€æ˜åº¦çš„æ—¶å€™ï¼Œstroke ä¼šå’Œ fill çš„ä¸€éƒ¨åˆ†é‡åˆåˆ°ä¸€èµ·ï¼Œå°±ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸäº†ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bufferCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bufferCtx <span class="token operator">=</span> bufferCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&#39;green&#39;</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;RGB(255, 0, 0)&#39;</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒçš„å®é™…å±•ç¤ºæ•ˆæœæ˜¯è¿™æ ·çš„ï¼Œä¸­é—´çš„ stroke å’Œ fill æœ‰ä¸€éƒ¨åˆ†é‡å ã€‚ <img src="https://camo.githubusercontent.com/4828d368c32e74643cbb46d198154e8d11830dc3610a082b9eca3f624f09449f/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f30343531323865362d303637332d343535662d383739302d6335336437346365353662622e706e67" alt="" loading="lazy"> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒKonvaJS å®ç°äº†ä¸€ä¸ª perfectDrawEnabled åŠŸèƒ½ï¼Œå®ƒä¼šè¿™æ ·åšï¼š</p><ol><li>åœ¨ bufferCanvas ä¸Šç»˜åˆ¶ Shape</li><li>ç»˜åˆ¶ fill å’Œ stroke</li><li>åœ¨ layer ä¸Šåº”ç”¨é€æ˜åº¦</li><li>å°† bufferCanvas ç»˜åˆ¶åˆ° sceneCanvas ä¸Šé¢å¯ä»¥çœ‹åˆ°å¼€å¯ perfectDrawEnabled å’Œå…³é—­ perfectDrawEnabled çš„åŒºåˆ«å¾ˆæ˜æ˜¾ï¼š <img src="https://camo.githubusercontent.com/5aa09e0b1727de6052f80f44d0dd13736059acfe0e84bb681cb09cc4f4d01ec5/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f63613061646131612d613263322d343363322d626262362d3534353264323365343534362e706e67" alt="" loading="lazy"> å®ƒä¼šåœ¨ Stage é‡Œé¢åˆ›å»ºä¸€ä¸ª bufferCanvas å’Œ bufferHitCanvasï¼Œå‰è€…å°±æ˜¯é’ˆå¯¹ sceneCanvas çš„ï¼Œåè€…æ˜¯é’ˆå¯¹ hitCanvas çš„ã€‚åœ¨ Shape çš„ drawScene æ–¹æ³•é‡Œé¢ï¼Œä¼šåˆ¤æ–­æ˜¯å¦ä½¿ç”¨ bufferCanvasï¼š</li></ol><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// if buffer canvas is needed</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_useBufferCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>skipBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  stage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bufferCanvas <span class="token operator">=</span> stage<span class="token punctuation">.</span>bufferCanvas<span class="token punctuation">;</span>
  bufferContext <span class="token operator">=</span> bufferCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bufferContext<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bufferContext<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bufferContext<span class="token punctuation">.</span><span class="token function">_applyLineJoin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// layer might be undefined if we are using cache before adding to layer</span>
  <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAbsoluteTransform</span><span class="token punctuation">(</span>top<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bufferContext<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>o<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> o<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> o<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> o<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> o<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> o<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åœ¨ bufferCanvas ç»˜åˆ¶ fill å’Œ stroke</span>
  <span class="token function">drawFunc</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> bufferContext<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bufferContext<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> ratio <span class="token operator">=</span> bufferCanvas<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasShadow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">_applyShadow</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åœ¨ sceneCanvas åº”ç”¨é€æ˜åº¦</span>
  context<span class="token punctuation">.</span><span class="token function">_applyOpacity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">_applyGlobalCompositeOperation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å°† bufferCanvas ç»˜åˆ¶åˆ° sceneCanvas</span>
  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>bufferCanvas<span class="token punctuation">.</span>_canvas<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bufferCanvas<span class="token punctuation">.</span>width <span class="token operator">/</span> ratio<span class="token punctuation">,</span> bufferCanvas<span class="token punctuation">.</span>height <span class="token operator">/</span> ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶"><span>äº‹ä»¶</span></a></h2><p>Konva é‡Œé¢çš„äº‹ä»¶æ˜¯åœ¨ Canvas å¤–å±‚åˆ›å»ºäº†ä¸€ä¸ª div èŠ‚ç‚¹ï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šé¢æ¥æ”¶äº† DOM äº‹ä»¶ï¼Œå†æ ¹æ®åæ ‡ç‚¹æ¥åˆ¤æ–­å½“å‰ç‚¹å‡»çš„æ˜¯å“ªä¸ª Shapeï¼Œç„¶åè¿›è¡Œäº‹ä»¶åˆ†å‘ã€‚æ‰€ä»¥å…³é”®å°±åœ¨å¦‚ä½•åˆ¤æ–­å½“å‰ç‚¹å‡»çš„ Shape æ˜¯å“ªä¸ªï¼Ÿç›¸æ¯” ZRender é‡Œé¢æ¯”è¾ƒå¤æ‚çš„è®¡ç®—ï¼ŒKonva ä½¿ç”¨äº†ä¸€ä¸ªç›¸å½“å·§å¦™çš„æ–¹å¼ã€‚</p><h3 id="äº‹ä»¶åˆ†å‘" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶åˆ†å‘"><span>äº‹ä»¶åˆ†å‘</span></a></h3><p>Konva ç›®å‰æ”¯æŒä¸‹é¢è¿™ä¹ˆå¤šäº‹ä»¶ï¼ŒEVENTS æ˜¯ <code>äº‹ä»¶å-äº‹ä»¶å¤„ç†æ–¹æ³•</code> çš„æ˜ å°„ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token constant">EVENTS</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token constant">MOUSEENTER</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerenter&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">MOUSEDOWN</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerdown&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">MOUSEMOVE</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointermove&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">MOUSEUP</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerup&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">MOUSELEAVE</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerleave&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TOUCHSTART</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerdown&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TOUCHMOVE</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointermove&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TOUCHEND</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerup&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TOUCHCANCEL</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointercancel&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">MOUSEOVER</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerover&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">WHEEL</span><span class="token punctuation">,</span> <span class="token string">&#39;_wheel&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CONTEXTMENU</span><span class="token punctuation">,</span> <span class="token string">&#39;_contextmenu&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">POINTERDOWN</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerdown&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">POINTERMOVE</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointermove&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">POINTERUP</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointerup&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">POINTERCANCEL</span><span class="token punctuation">,</span> <span class="token string">&#39;_pointercancel&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">LOSTPOINTERCAPTURE</span><span class="token punctuation">,</span> <span class="token string">&#39;_lostpointercapture&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// ç»‘å®šäº‹ä»¶</span>
  <span class="token function">_bindContentEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Konva<span class="token punctuation">.</span>isBrowser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token constant">EVENTS</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>event<span class="token punctuation">,</span> methodName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token punctuation">{</span>
      <span class="token comment">// äº‹ä»¶ç»‘å®šåœ¨ content è¿™ä¸ª dom èŠ‚ç‚¹ä¸Šé¢</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">[</span>methodName<span class="token punctuation">]</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä»¥ mousedown è¿™ä¸ªå…·ä½“çš„äº‹ä»¶ä½œä¸ºä¾‹å­æ¥åˆ†æï¼Œå®ƒçš„å¤„ç†æ–¹æ³•åœ¨ <code>_pointerdown</code> é‡Œé¢ã€‚ <code>_pointerdown</code> å…ˆæ‰§è¡Œäº† <code>setPointersPositions</code>ï¼Œè®¡ç®—å½“å‰é¼ æ ‡ç‚¹å‡»çš„åæ ‡ï¼Œå‡å» content ç›¸å¯¹é¡µé¢çš„åæ ‡ï¼Œå¾—åˆ°äº†å½“å‰ç‚¹å‡»ç›¸å¯¹äº content çš„åæ ‡ã€‚åŒæ—¶å°†å…¶å­˜å…¥äº† <code>_changedPointerPositions</code> é‡Œé¢ã€‚ <img src="https://camo.githubusercontent.com/b9b5d26a9416879dc1be928551640eba483b5af33a0af809def5f2b2fc6a5fea/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f32393861326332322d363837332d343464352d393234662d3331306461343239313931302e706e67" alt="" loading="lazy"> ç„¶åéå† <code>_changedPointerPositions</code>ï¼Œé€šè¿‡ <code>getIntersection</code> è·å–åˆ°äº†ç‚¹å‡»çš„ Shape å›¾å½¢ã€‚è¿™ä¸ª <code>getIntersection</code> éå†è°ƒç”¨äº†æ¯ä¸ª Layer çš„ <code>getIntersection</code> æ–¹æ³•ï¼Œé€šè¿‡ Layer è·å–åˆ°äº†å¯¹åº”çš„ Shapeã€‚å› ä¸ºå¯ä»¥å­˜åœ¨å¤šä¸ª Layerï¼Œæ¯ä¸ª Layer ä¹Ÿå¯ä»¥åœ¨åŒä¸€ä¸ªä½ç½®ç»˜åˆ¶å¤šä¸ª Shapeï¼Œæ‰€ä»¥ç†è®ºä¸Šå¯ä»¥è·å–åˆ°å¤šä¸ª Shapeï¼ŒKonva è¿™é‡Œåªå–äº†ç¬¬ä¸€ä¸ª Shapeï¼ŒæŒ‰ç…§ Layer -Shape çš„é¡ºåºæ¥çš„ã€‚ <img src="https://camo.githubusercontent.com/a462a32aa3f2bf7f01f52a225069d66a35b7ffbb9de0320ec7bfabb81a21b2e0/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f34663139613934392d303035372d346434632d393032342d3561633637373838663239382e706e67" alt="" loading="lazy"> ç„¶å Stage ä¼šè°ƒç”¨ Shape ä¸Šé¢çš„ <code>_fireAndBubble</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è°ƒç”¨ <code>_fire</code> å‘é€ Konva è‡ªå·±çš„äº‹ä»¶ï¼Œæ­¤æ—¶é€šè¿‡ on ç»‘å®šçš„äº‹ä»¶å›è°ƒå°±ä¼šè§¦å‘ï¼Œæœ‰ç‚¹å„¿åƒ jQuery é‚£æ ·ã€‚ç„¶å Konva ä¼šç»§ç»­å¾€ä¸Šæ‰¾åˆ°çˆ¶èŠ‚ç‚¹ï¼Œç»§ç»­è°ƒç”¨çˆ¶èŠ‚ç‚¹çš„ <code>_fireAndBubble</code> æ–¹æ³•ï¼Œç›´åˆ°å†ä¹Ÿæ‰¾ä¸åˆ°çˆ¶èŠ‚ç‚¹ä¸ºæ­¢ï¼Œè¿™æ ·å°±å®ç°äº†äº‹ä»¶å†’æ³¡ã€‚å¯¹äºä¸æƒ³è¢«ç‚¹å‡»åˆ°çš„ Shape æ¥è¯´ï¼Œå¯ä»¥è®¾ç½® <code>isListening</code> å±æ€§ä¸º falseï¼Œè¿™æ ·äº‹ä»¶å°±ä¸ä¼šè§¦å‘äº†ã€‚</p><h3 id="åŒ¹é…-shape" tabindex="-1"><a class="header-anchor" href="#åŒ¹é…-shape"><span>åŒ¹é… Shape</span></a></h3><p>é‚£ä¹ˆ Layer æ˜¯æ€ä¹ˆæ ¹æ®ç‚¹å‡»åæ ‡è·å–åˆ°å¯¹åº”çš„ Shape å‘¢ï¼Ÿå¦‚æœæ˜¯è§„åˆ™çš„å›¾å½¢ï¼ˆçŸ©å½¢ã€åœ†å½¢ï¼‰è¿˜æ¯”è¾ƒå®¹æ˜“è®¡ç®—ï¼Œè¦æ˜¯ä¸‹é¢è¿™ç§ä¸è§„åˆ™å›¾å½¢å‘¢ï¼Ÿ <img src="https://camo.githubusercontent.com/56f41e90923fd22589829ba27314071b45fccabf3584bd84fef6096769120833/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f33353666323635322d663831332d343434362d393265612d3563383735363035303631342e706e67" alt="" loading="lazy"> ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨ Canvas é‡Œé¢æœ‰ä¸ª <code>getImageData</code> æ–¹æ³•ï¼Œå®ƒä¼šæ ¹æ®ä¼ å…¥çš„åæ ‡æ¥è¿”å›ä¸€ä¸ª ImageData ä¿¡æ¯ï¼Œé‡Œé¢æœ‰å½“å‰åæ ‡å¯¹åº”çš„è‰²å€¼ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½æ ¹æ®è¿™ä¸ªè‰²å€¼æ¥è·å–åˆ°å¯¹åº”çš„ Shape å‘¢ï¼Ÿ <img src="https://camo.githubusercontent.com/e975ab71150c628666949ce3803e1e6d50e6045bd370850de3e2ae65f495aa20/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f36396264363065342d306335302d346465662d613564372d3665303531393761323663392e706e67" alt="" loading="lazy"> å› æ­¤ï¼ŒKonva åœ¨åˆ›å»º Layer çš„æ—¶å€™ä¼šåˆ›å»ºä¸¤ä¸ª Canvasï¼Œä¸€ä¸ªç”¨äº sceneCanvas ç”¨äºç»˜åˆ¶ Shapeï¼Œå¦ä¸€ä¸ª hitCanvas åœ¨å†…å­˜é‡Œé¢ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«æ‰“å‡»ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SceneCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hitCanvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HitCanvas</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pixelRatio</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://camo.githubusercontent.com/352ea8233908db8e9464a7b814deb15ebf770b61c171ca4067da513109f29deb/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f35333735653761642d393835332d343236302d613265312d6631633263643738366662642e706e67" alt="" loading="lazy"> å½“ Shape åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªéšæœºçš„é¢œè‰²ï¼Œä»¥è¿™ä¸ªé¢œè‰²ä½œä¸º key å­˜å…¥åˆ° shapes æ•°ç»„é‡Œé¢ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token operator">?</span><span class="token operator">:</span> Config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// set colorKey</span>
    <span class="token keyword">let</span> <span class="token literal-property property">key</span><span class="token operator">:</span> string<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ç”Ÿæˆéšæœºè‰²å€¼</span>
      key <span class="token operator">=</span> Util<span class="token punctuation">.</span><span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> shapes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colorKey <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token comment">// å­˜å…¥ shapes æ•°ç»„</span>
    shapes<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯æ¬¡åœ¨ sceneCanvas ä¸Šé¢ç»˜åˆ¶çš„æ—¶å€™ï¼ŒåŒæ ·ä¼šåœ¨å†…å­˜ä¸­çš„ hitCanvas é‡Œé¢ç»˜åˆ¶ä¸€éï¼Œå¹¶ä¸”å°†ä¸Šé¢éšæœºç”Ÿæˆçš„è‰²å€¼ä½œä¸º fill å’Œ stroke çš„é¢œè‰²å¡«å……ã€‚å½“ç‚¹å‡» sceneCanvas çš„æ—¶å€™ï¼Œè·å–åˆ°ç‚¹å‡»çš„åæ ‡ç‚¹ï¼Œé€šè¿‡è°ƒç”¨ hitCanvas çš„ <code>getImageData</code> å°±å¯ä»¥è·å–åˆ° colorKeyï¼Œç„¶åå†é€šè¿‡ colorKey å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„ Shape äº†ï¼ŒçœŸæ˜¯ç›¸å½“å·§å¦™çš„å®ç°ã€‚ <img src="https://camo.githubusercontent.com/821609f511a6cd1760042d9fea1d66ce53deabed1e2628df0683b73e898cba16/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f62376437653336382d643833622d343765342d613234382d3734613732306133656665632e706e67" alt="" loading="lazy"> ä½†è¿™ç§æ–¹å¼ä¹Ÿæœ‰ç¼ºé™·ï¼Œå› ä¸ºç”Ÿæˆçš„éšæœº hex é¢œè‰²æ˜¯æœ‰ä¸Šé™çš„ï¼Œæœ€å¤šä¼šä¼šæœ‰ 256<em>256</em> 256 = 16777216 ç§ï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¹ˆå¤šå°±ä¼šå¯¼è‡´åŒ¹é…ä¸å‡†ç¡®ã€‚ä¸è¿‡è€ƒè™‘ä¸€ä¸‹å¦‚æœæœ‰ 16777216 ä¸ª DOM èŠ‚ç‚¹ï¼Œæµè§ˆå™¨å°±ä¼šå¡çˆ†äº†ï¼Œæ¢æˆè¿™ä¹ˆå¤š Canvas å›¾å½¢ä¸€æ ·ä¼šå¯¼è‡´æ€§èƒ½çˆ†ç‚¸ã€‚</p><h3 id="è‡ªå®šä¹‰-hitfunc" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰-hitfunc"><span>è‡ªå®šä¹‰ hitFunc</span></a></h3><p>å¦‚æœä½ æƒ³è‡ªå®šä¹‰äº‹ä»¶å“åº”åŒºåŸŸï¼ŒKonva ä¹Ÿæä¾›äº† hitFunc æ–¹æ³•ç»™ä½ å®ç°ã€‚åœ¨ç»˜åˆ¶ hitCanvas çš„æ—¶å€™ï¼ŒåŸæœ¬çš„ç»˜åˆ¶ sceneFunc å°±å¤±æ•ˆäº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç»˜åˆ¶ hitFuncã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">drawHit</span><span class="token punctuation">(</span><span class="token parameter">can<span class="token operator">?</span><span class="token operator">:</span> HitCanvas<span class="token punctuation">,</span> top<span class="token operator">?</span><span class="token operator">:</span> Node<span class="token punctuation">,</span> skipDragCheck <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shouldDrawHit</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> skipDragCheck<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> layer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      canvas <span class="token operator">=</span> can <span class="token operator">||</span> layer<span class="token punctuation">.</span>hitCanvas<span class="token punctuation">,</span>
      context <span class="token operator">=</span> canvas <span class="token operator">&amp;&amp;</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// å¦‚æœæœ‰ hitFuncï¼Œå°±ä¸ä½¿ç”¨ sceneFunc</span>
      drawFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hitFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sceneFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      cachedCanvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getCanvasCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      cachedHitCanvas <span class="token operator">=</span> cachedCanvas <span class="token operator">&amp;&amp;</span> cachedCanvas<span class="token punctuation">.</span>hit<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Util<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">&#39;Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()&#39;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
    <span class="token function">drawFunc</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‹–æ‹½äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#æ‹–æ‹½äº‹ä»¶"><span>æ‹–æ‹½äº‹ä»¶</span></a></h3><p>Konva çš„æ‹–æ‹½äº‹ä»¶æ²¡æœ‰ä½¿ç”¨åŸç”Ÿçš„æ–¹æ³•ï¼Œè€Œæ˜¯åŸºäº mousemove å’Œ touchmove æ¥è®¡ç®—ç§»åŠ¨çš„è·ç¦»ï¼Œè¿›è€Œæ‰‹åŠ¨è®¾ç½® Shape çš„ä½ç½®ï¼Œå®ç°é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä¸ç»†è¯´ã€‚</p><h2 id="æ»¤é•œ" tabindex="-1"><a class="header-anchor" href="#æ»¤é•œ"><span>æ»¤é•œ</span></a></h2><p>Konva æ”¯æŒå¤šç§æ»¤é•œï¼Œåœ¨ä½¿ç”¨æ»¤é•œä¹‹å‰éœ€è¦å…ˆå°† Shape cache èµ·æ¥ï¼Œç„¶åä½¿ç”¨ <code>filter()</code> æ–¹æ³•æ·»åŠ æ»¤é•œã€‚ åœ¨ cache é‡Œé¢é™¤äº†åˆ›å»ºç”¨äºç¦»å±æ¸²æŸ“çš„ Canvasï¼Œè¿˜ä¼šåˆ›å»ºæ»¤é•œ Canvasã€‚æ»¤é•œå¤„ç†åœ¨ <code>_getCachedSceneCanvas</code> é‡Œé¢ã€‚ <img src="https://camo.githubusercontent.com/5736b6469b94b56d537b2a76c8999e3b307278d42527a4bb7f4d87f2b68357cd/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f39346434613735622d626262362d343861312d623036302d6165376530386164626130382e706e67" alt="" loading="lazy"> é¦–å…ˆå°† sceneCanvas é€šè¿‡ drawImage ç»˜åˆ¶åˆ° filterCanvas ä¸Šé¢ï¼Œæ¥ç€ filterCanvas è·å–æ‰€æœ‰çš„ ImageDataï¼Œéå†æ‰€æœ‰è®¾ç½®çš„æ»¤é•œæ–¹æ³•ï¼Œå°† ImageData ä¼ ç»™æ»¤é•œæ–¹æ³•æ¥å¤„ç†ã€‚å¤„ç†å®Œ ImageData ä¹‹åï¼Œå†å°†å…¶é€šè¿‡ putImageData ç»˜åˆ¶åˆ° filterCanvas ä¸Šé¢ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_filterUpToDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ratio <span class="token operator">=</span> sceneCanvas<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">;</span>
    filterCanvas<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>sceneCanvas<span class="token punctuation">.</span>width <span class="token operator">/</span> sceneCanvas<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">,</span> sceneCanvas<span class="token punctuation">.</span>height <span class="token operator">/</span> sceneCanvas<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      len <span class="token operator">=</span> filters<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      filterContext<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// copy cached canvas onto filter context</span>
      filterContext<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
        sceneCanvas<span class="token punctuation">.</span>_canvas<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        sceneCanvas<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> ratio<span class="token punctuation">,</span>
        sceneCanvas<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> ratio
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      imageData <span class="token operator">=</span> filterContext<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> filterCanvas<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filterCanvas<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// apply filters to filter context</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        filter <span class="token operator">=</span> filters<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> filter <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Util<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
            <span class="token string">&#39;Filter should be type of function, but got &#39;</span> <span class="token operator">+</span> <span class="token keyword">typeof</span> filter <span class="token operator">+</span> <span class="token string">&#39; instead. Please check correct filters&#39;</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">filter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> imageData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterContext<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Util<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
        <span class="token string">&#39;Unable to apply filter. &#39;</span> <span class="token operator">+</span>
          e<span class="token punctuation">.</span>message <span class="token operator">+</span>
          <span class="token string">&#39; This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.&#39;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>_filterUpToDate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> filterCanvas<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£æ»¤é•œæ•ˆæœæ€ä¹ˆç”»ä¸Šå»çš„å‘¢ï¼Ÿåœ¨ konva é‡Œé¢è¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ï¼Œå¦‚æœå­˜åœ¨ filterCanvasï¼Œé‚£å°±ä¸ä¼šä½¿ç”¨ cacheCanvas äº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åŸæœ¬ç”¨äºç¼“å­˜çš„ç¦»å± Canvas ä¼šè¢« filterCanvas è¿›è¡Œæ›¿ä»£ã€‚æœ€ç»ˆ filterCanvas ä¼šé€šè¿‡ drawImage çš„æ–¹å¼ç»˜åˆ¶åˆ° sceneCanvas ä¸Šé¢ã€‚</p><h2 id="é€‰æ‹©å™¨" tabindex="-1"><a class="header-anchor" href="#é€‰æ‹©å™¨"><span>é€‰æ‹©å™¨</span></a></h2><p>Konva å®ç°äº†é€‰æ‹©å™¨ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¿«é€ŸæŸ¥æ‰¾åˆ°æŸä¸ª Shapeã€‚ç›®å‰ä¸»è¦æœ‰ä¸‰ç§é€‰æ‹©å™¨ï¼Œåˆ†åˆ«æ˜¯ id é€‰æ‹©å™¨ã€name é€‰æ‹©å™¨ã€type é€‰æ‹©å™¨ã€‚å‰ä¸¤è€…éœ€è¦åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ª id æˆ–è€… name å±æ€§ï¼Œåè€…åˆ™æ˜¯æ ¹æ®ç±»åï¼ˆRectã€Line ç­‰ï¼‰æ¥æŸ¥æ‰¾çš„ã€‚é€‰æ‹©å™¨æŸ¥æ‰¾çš„æ—¶å€™éœ€è¦è°ƒç”¨ find æ–¹æ³•ï¼Œè¿™ä¸ª find æ–¹æ³•æŒ‚è½½åœ¨ Container ç±»ä¸Šé¢ã€‚å®ƒè°ƒç”¨äº† _descendants è¿›è¡Œå­èŠ‚ç‚¹çš„éå†ï¼Œå°†éå†çš„ node èŠ‚ç‚¹è°ƒç”¨ isMatch æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…ä¸Šã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  _generalFind<span class="token operator">&lt;</span>ChildNode <span class="token keyword">extends</span> <span class="token class-name">Node</span> <span class="token operator">=</span> Node<span class="token operator">&gt;</span><span class="token punctuation">(</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> string <span class="token operator">|</span> Function<span class="token punctuation">,</span>
    <span class="token literal-property property">findOne</span><span class="token operator">:</span> boolean
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token literal-property property">retArr</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>ChildNode<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// è°ƒç”¨ _descendants è·å–æ‰€æœ‰çš„å­èŠ‚ç‚¹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_descendants</span><span class="token punctuation">(</span><span class="token punctuation">(</span>node<span class="token operator">:</span> ChildNode<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> valid <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">_isMatch</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        retArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// å¦‚æœæ˜¯ findOneï¼Œåé¢çš„å°±ä¸ç»§ç»­æ‰§è¡Œäº†</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>valid <span class="token operator">&amp;&amp;</span> findOne<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> retArr<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">_descendants</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span>n<span class="token operator">:</span> Node<span class="token punctuation">)</span> <span class="token operator">=</span>boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> shouldStop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> child <span class="token keyword">of</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      shouldStop <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldStop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">.</span><span class="token function">hasChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// å¦‚æœå­èŠ‚ç‚¹ä¹Ÿæœ‰å­èŠ‚ç‚¹ï¼Œé‚£å°±é€’å½’éå†</span>
      shouldStop <span class="token operator">=</span> <span class="token punctuation">(</span>child <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_descendants</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// å¦‚æœåº”è¯¥åœæ­¢æŸ¥æ‰¾ï¼ˆä¸€èˆ¬æ˜¯ findOne çš„æ—¶å€™å°±ä¸éœ€è¦æŸ¥æ‰¾åé¢çš„äº†ï¼‰</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldStop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ isMatch é‡Œé¢å¯ä»¥çœ‹åˆ°åæ ¹æ®æ˜¯ä»€ä¹ˆç±»å‹çš„é€‰æ‹©å™¨æ¥åˆ†åˆ«è¿›è¡ŒåŒ¹é…ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// id selector</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>sel<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sel<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// name selector</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasName</span><span class="token punctuation">(</span>sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>className <span class="token operator">===</span> sel <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeType <span class="token operator">===</span> sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åºåˆ—åŒ–" tabindex="-1"><a class="header-anchor" href="#åºåˆ—åŒ–"><span>åºåˆ—åŒ–</span></a></h2><p>Konva è¿˜æ”¯æŒå¯¹ Stage çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç®€å•æ¥è¯´å°±æ˜¯æŠŠ Stage çš„æ•°æ®å¯¼å‡ºæˆä¸€ä»½ JSON æ•°æ®ä»¥åŠæŠŠ JSON æ•°æ®å¯¼å…¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨ NodeJS ç«¯è¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“ã€‚åºåˆ—åŒ–ä¸»è¦åœ¨ toObject æ–¹æ³•é‡Œé¢ï¼Œå®ƒä¼šå¯¹å‡½æ•°å’Œ DOM èŠ‚ç‚¹è¿›è¡Œè¿‡æ»¤ï¼Œåªä¿ç•™ä¸€ä»½æè¿°ä¿¡æ¯ï¼Œæ¯”å¦‚ Layer çš„ä¿¡æ¯ã€Shape çš„ä¿¡æ¯ç­‰ç­‰ï¼Œæœ‰ç‚¹å„¿ç±»ä¼¼ React é‡Œé¢çš„ Virtual DOMã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> any<span class="token punctuation">,</span>
      attrs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      key<span class="token punctuation">,</span>
      val<span class="token punctuation">,</span>
      getter<span class="token punctuation">,</span>
      defaultValue<span class="token punctuation">,</span>
      nonPlainObject<span class="token punctuation">;</span>

    obj<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      val <span class="token operator">=</span> attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      nonPlainObject <span class="token operator">=</span>
        Util<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Util<span class="token punctuation">.</span><span class="token function">_isPlainObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Util<span class="token punctuation">.</span><span class="token function">_isArray</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>nonPlainObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      getter <span class="token operator">=</span> <span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">delete</span> attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// ç‰¹æ®Šå¤„ç†å‡½æ•°ï¼Œå°†å…¶æ‰§è¡ŒåæŠŠç»“æœæŒ‚è½½åˆ°å½“å‰keyä¸Šé¢</span>
      defaultValue <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token comment">// restore attr value</span>
      attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultValue <span class="token operator">!==</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        obj<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    obj<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Util<span class="token punctuation">.</span><span class="token function">_prepareToStringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œååºåˆ—åŒ–åˆ™æ˜¯å¯¹ä¼ å…¥çš„ JSON ä¿¡æ¯è¿›è¡Œè§£æï¼Œæ ¹æ® className æ¥åˆ›å»ºä¸åŒçš„å¯¹è±¡ï¼Œå¯¹æ·±å±‚ç»“æ„è¿›è¡Œé€’å½’ï¼Œç„¶å add åˆ°çˆ¶èŠ‚ç‚¹é‡Œé¢ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token keyword">static</span> <span class="token function">_createNode</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> container<span class="token operator">?</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> className <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">,</span>
      children <span class="token operator">=</span> obj<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
      no<span class="token punctuation">,</span>
      len<span class="token punctuation">,</span>
      n<span class="token punctuation">;</span>

    <span class="token comment">// if container was passed in, add it to attrs</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>container <span class="token operator">=</span> container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Konva<span class="token punctuation">[</span>className<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Util<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">&#39;Can not find a node with class name &quot;&#39;</span> <span class="token operator">+</span>
          className <span class="token operator">+</span>
          <span class="token string">&#39;&quot;. Fallback to &quot;Shape&quot;.&#39;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      className <span class="token operator">=</span> <span class="token string">&#39;Shape&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ ¹æ®ä¼ å…¥çš„ className æ¥å®ä¾‹åŒ–</span>
    <span class="token keyword">const</span> Class <span class="token operator">=</span> Konva<span class="token punctuation">[</span>className<span class="token punctuation">]</span><span class="token punctuation">;</span>

    no <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      len <span class="token operator">=</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœè¿˜æœ‰å­èŠ‚ç‚¹ï¼Œé‚£å°±é€’å½’åˆ›å»º</span>
        no<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Node<span class="token punctuation">.</span><span class="token function">_createNode</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> no<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="react" tabindex="-1"><a class="header-anchor" href="#react"><span>React</span></a></h2><p>Konva å’Œ React ç»‘å®šæ²¡æœ‰ä½¿ç”¨é‡æ–°å°è£…ä¸€éç»„ä»¶çš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å’Œ react-domã€react-native ä¸€æ ·çš„å½¢å¼ï¼ŒåŸºäº react-reconciler æ¥å®ç°ä¸€å¥— hostConfigï¼Œä»è€Œå®šåˆ¶è‡ªå·±çš„ Host Componentï¼ˆå®¿ä¸»ç»„ä»¶ï¼‰ã€‚</p><h3 id="react-reconciler" tabindex="-1"><a class="header-anchor" href="#react-reconciler"><span>react-reconciler</span></a></h3><p>React Fiber æ¶æ„è¯ç”Ÿä¹‹åï¼Œä»–ä»¬å°±å°†åŸæ¥çš„ React æ ¸å¿ƒä»£ç åšäº†æŠ½ç¦»ã€‚ä¸»è¦åŒ…æ‹¬ reactã€react-reconciler å’Œ platform å®ç°ï¼ˆreact-domã€react-native ç­‰ï¼‰ä¸‰éƒ¨åˆ†ã€‚åœ¨ react-reconciler é‡Œé¢å®ç°äº†å¤§åé¼é¼çš„ Diff ç®—æ³•ã€æ—¶é—´åˆ‡ç‰‡ã€è°ƒåº¦ç­‰ç­‰ï¼Œå®ƒè¿˜æš´éœ²ç»™äº†æˆ‘ä»¬ä¸€ä¸ª hostConfig æ–‡ä»¶ï¼Œå…è®¸æˆ‘ä»¬åœ¨å„ç§é’©å­å‡½æ•°ä¸­å®ç°è‡ªå·±çš„æ¸²æŸ“ã€‚åœ¨ React é‡Œé¢ï¼Œæœ‰ä¸¤ç§ç»„ä»¶ç±»å‹ï¼Œä¸€ç§æ˜¯ Host Componentï¼ˆå®¿ä¸»ç»„ä»¶ï¼‰ï¼Œå¦ä¸€ç§æ˜¯ Composition Componentï¼ˆå¤åˆç»„ä»¶ï¼‰ã€‚åœ¨ DOM é‡Œé¢ï¼Œå‰è€…å°±æ˜¯ h1ã€divã€span ç­‰å…ƒç´ ï¼Œåœ¨ react-native é‡Œé¢ï¼Œå‰è€…å°±æ˜¯ Viewã€Textã€ScrollView ç­‰å…ƒç´ ã€‚åè€…åˆ™æ˜¯æˆ‘ä»¬åŸºäº Host Component è‡ªå®šä¹‰çš„ç»„ä»¶ï¼Œæ¯”å¦‚ Appã€Header ç­‰ç­‰ã€‚åœ¨ react-reconciler é‡Œé¢ï¼Œå®ƒå…è®¸æˆ‘ä»¬å»è‡ªå®šä¹‰ Host Component çš„æ¸²æŸ“ï¼ˆå¢åˆ æŸ¥æ”¹ï¼‰ï¼Œè¿™ä¹Ÿæ„å‘³ç€è·¨å¹³å°çš„èƒ½åŠ›ã€‚æˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸€ä»½ hostConfig æ–‡ä»¶ï¼Œå°±èƒ½å¤Ÿå®ç°è‡ªå·±çš„æ¸²æŸ“ã€‚ <img src="https://camo.githubusercontent.com/695f54a7f71577ec66604e45270bc623eabb928e823bcce2b564d636de17997a/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f64333463333963632d386464312d346239382d613933332d6533633338303164643739332e706e67" alt="" loading="lazy"> å‚è€ƒä¸Šé¢çš„æ¶æ„å›¾ï¼Œä¼šå‘ç°ä¸ç®¡æ˜¯æ¸²æŸ“åˆ° nativeã€canvasï¼Œç”šè‡³æ˜¯å°ç¨‹åºéƒ½å¯ä»¥ã€‚ä¸šç•Œå·²ç»æœ‰æ–¹æ¡ˆæ˜¯åŸºäºè¿™ä¸ªæ¥å®ç°äº†ï¼Œå¯ä»¥å‚è€ƒèš‚èšé‡‘æœçš„ remaxï¼š<a href="https://zhuanlan.zhihu.com/p/79788488" target="_blank" rel="noopener noreferrer">Remax - ä½¿ç”¨çœŸæ­£çš„ React æ„å»ºå°ç¨‹åº<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="react-konva" tabindex="-1"><a class="header-anchor" href="#react-konva"><span>react-konva</span></a></h3><p>react-konva çš„ä¸»è¦å®ç°å°±åœ¨ ReactKonvaHostConfig.js é‡Œé¢ï¼Œå®ƒåˆ©ç”¨ Konva åŸæœ¬çš„ API å®ç°äº†å¯¹ Virtual DOM çš„æ˜ å°„ï¼Œå“åº”äº† Virtual DOM çš„å¢åˆ æŸ¥æ”¹ã€‚è¿™é‡Œä»ä¸­æŠ½å–äº†éƒ¨åˆ†æºç ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// åˆ›å»ºä¸€ä¸ªå®ä¾‹</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> internalInstanceHandle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> NodeClass <span class="token operator">=</span> Konva<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> propsWithoutEvents <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> propsWithOnlyEvents <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> isEvent <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;on&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      propsWithOnlyEvents<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      propsWithoutEvents<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ ¹æ®ä¼ å…¥çš„ type æ¥åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç›¸å½“äº new Layerã€new Rect ç­‰</span>
  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeClass</span><span class="token punctuation">(</span>propsWithoutEvents<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å°†ä¼ å…¥çš„ props è®¾ç½®åˆ°å®ä¾‹ä¸Šé¢</span>
  <span class="token comment">// å¦‚æœæ˜¯æ™®é€šçš„ propï¼Œå°±ç›´æ¥é€šè¿‡ instance.setAttr æ›´æ–°</span>
  <span class="token comment">// å¦‚æœæ˜¯ onClick ä¹‹ç±»çš„äº‹ä»¶ï¼Œå°±é€šè¿‡ instance.on æ¥ç»‘å®š</span>
  <span class="token function">applyNodeProps</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> propsWithOnlyEvents<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ’å…¥å­èŠ‚ç‚¹ï¼Œç›´æ¥è°ƒç”¨ konva çš„ add æ–¹æ³•</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token parameter">parentInstance<span class="token punctuation">,</span> child</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>parent <span class="token operator">===</span> parentInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    child<span class="token punctuation">.</span><span class="token function">moveToTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    parentInstance<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">updatePicture</span><span class="token punctuation">(</span>parentInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç§»é™¤å­èŠ‚ç‚¹ï¼Œç›´æ¥è°ƒç”¨ destroy æ–¹æ³•</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token parameter">parentInstance<span class="token punctuation">,</span> child</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  child<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  child<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token constant">EVENTS_NAMESPACE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updatePicture</span><span class="token punctuation">(</span>parentInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// é€šè¿‡è®¾ç½® zIndex å®ç° insertBefore</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token parameter">parentInstance<span class="token punctuation">,</span> child<span class="token punctuation">,</span> beforeChild</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// child._remove() will not stop dragging</span>
  <span class="token comment">// but child.remove() will stop it, but we don&#39;t need it</span>
  <span class="token comment">// removing will reset zIndexes</span>
  child<span class="token punctuation">.</span><span class="token function">_remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  parentInstance<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
  child<span class="token punctuation">.</span><span class="token function">setZIndex</span><span class="token punctuation">(</span>beforeChild<span class="token punctuation">.</span><span class="token function">getZIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updatePicture</span><span class="token punctuation">(</span>parentInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="vue-konva" tabindex="-1"><a class="header-anchor" href="#vue-konva"><span>vue-konva</span></a></h2><p>åœ¨ Vue ä¸Šé¢ï¼ŒKonva é€šè¿‡ Vue.use æ³¨å†Œäº†ä¸€ä¸ªæ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶é‡Œé¢åˆ†åˆ«æ³¨å†Œäº†æ¯ä¸ªç»„ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> components <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Stage&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> Stage
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span><span class="token constant">KONVA_NODES</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>name <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token function">KonvaNode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> VueKonva <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">install</span><span class="token operator">:</span> <span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> prefixToUse <span class="token operator">=</span> componentPrefix<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>prefix<span class="token punctuation">)</span><span class="token punctuation">{</span>
      prefixToUse <span class="token operator">=</span> options<span class="token punctuation">.</span>prefix<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    components<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>k <span class="token operator">=</span><span class="token punctuation">{</span>
      Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixToUse<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> k<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> VueKonva<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueKonva<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æ¥çœ‹çœ‹ KonvaNode çš„å®ç°ï¼Œåœ¨ KonvaNode é‡Œé¢ï¼Œå¯¹äºèŠ‚ç‚¹çš„å¢åˆ æŸ¥æ”¹éƒ½åœ¨ Vue çš„ç”Ÿå‘½å‘¨æœŸé‡Œé¢å®ç°çš„ã€‚ åœ¨ Vue çš„ created ç”Ÿå‘½å‘¨æœŸé‡Œé¢è°ƒç”¨ initKonva å» new ä¸€ä¸ª NodeClassï¼Œå’Œä¸Šé¢ React çš„æ–¹å¼å‡ ä¹ä¸€æ ·ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>      <span class="token function">initKonva</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> NodeClass <span class="token operator">=</span> window<span class="token punctuation">.</span>Konva<span class="token punctuation">[</span>nameNode<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>NodeClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;vue-konva error: Can not find node &#39;</span> <span class="token operator">+</span> nameNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>_konvaNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_konvaNode<span class="token punctuation">.</span>VueComponent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uploadKonva</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œåœ¨ Updated çš„æ—¶å€™å»è¿›è¡Œ Props çš„æ›´æ–°ï¼Œåœ¨ destroyed é‡Œé¢å¯¹èŠ‚ç‚¹è¿›è¡Œ destroyï¼Œå®ç°ä¸Šæ›´åŠ ç®€æ´ä¸€äº›ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>    <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uploadKonva</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">checkOrder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$vnode<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_konvaNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updatePicture</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_konvaNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_konvaNode<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_konvaNode<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token constant">EVENTS_NAMESPACE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¼ºé™·" tabindex="-1"><a class="header-anchor" href="#ç¼ºé™·"><span>ç¼ºé™·</span></a></h2><h3 id="è„çŸ©å½¢" tabindex="-1"><a class="header-anchor" href="#è„çŸ©å½¢"><span>è„çŸ©å½¢</span></a></h3><p>åœ¨æ€§èƒ½æ–¹é¢ï¼ŒKonva å¯¹æ¯” PIXIã€ZRender è¿™äº›åº“è¿˜æ˜¯ä¸å¤ªå¤Ÿçœ‹ã€‚å¦‚æœæˆ‘ä»¬ Layer ä¸Šæœ‰éå¸¸å¤šçš„ Shapeï¼Œå¦‚æœæƒ³æ›´æ–°æŸä¸ª Shapeï¼ŒæŒ‰ç…§ Konva çš„å®ç°æ–¹å¼ä¾ç„¶ä¼šå…¨é‡ç»˜åˆ¶ã€‚è™½ç„¶ Konva æ”¯æŒå•ä¸ª Shape é‡ç»˜ï¼Œä½†å®ç°ä¸Šæ˜¯æ— è„‘è¦†ç›–åŸæ¥çš„ä½ç½®ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¦‚æœä½ çš„å›¾å½¢åœ¨å…¶ä»–èŠ‚ç‚¹å›¾å½¢ä¸‹é¢ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚æ‰€ä»¥è¿™é‡Œç¼ºå°‘éå¸¸é‡è¦çš„å±€éƒ¨æ›´æ–°èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è„çŸ©å½¢ã€‚è„çŸ©å½¢å°±æ˜¯æŒ‡å½“æˆ‘ä»¬æ›´æ–°ä¸€ä¸ª Shape çš„æ—¶å€™ï¼Œåˆ©ç”¨ç¢°æ’æ£€æµ‹è®¡ç®—å‡ºå’Œä»–ç›¸äº¤çš„æ‰€æœ‰ Shapeï¼Œå°†å…¶è¿›è¡Œåˆå¹¶ï¼Œè®¡ç®—å‡ºä¸€å—å„¿è„åŒºåŸŸã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ clip é™åˆ¶ Canvas åªåœ¨è¿™å—å„¿è„åŒºè¿›è¡Œç»˜åˆ¶ï¼Œè¿™æ ·å°±å®ç°äº†å±€éƒ¨æ›´æ–°ã€‚ <img src="https://camo.githubusercontent.com/0c8f0933195af9f1afa41f3f2a373158a101454f3c36c8a585eee32337a9f33c/68747470733a2f2f66696c65732e6d646e6963652e636f6d2f757365722f343537372f63616536613739652d623937312d343238392d393432652d6536303539366537303432362e706e67" alt="" loading="lazy"> å¯æƒœ Konva çš„åŒ…å›´ç›’å®ç°çš„éå¸¸ç®€å•ï¼Œä¸é€‚åˆåšç¢°æ’æ£€æµ‹ï¼Œå®ƒä¹Ÿæ²¡æœ‰æä¾›è„çŸ©å½¢çš„èƒ½åŠ›ã€‚</p></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/h7ml/h7ml/edit/main/h7ml/posts/graphics/konva.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: h7ml@qq.com">h7ml</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/posts/graphics/fabric.html" aria-label="fabric"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon iconfont icon-card" style=""></span>fabric</div></a><!----></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href='https://v6.51.la/s/N6M38h8J5TZZXKh' id="LA-DATA-WIDGET" target='blank'>51.la</a><a href='https://beian.mit.gov.cn/' target='blank'>æµ™ICPå¤‡2021037683å·-2</a></div><div class="vp-copyright">Copyright Â© 2024 h7ml </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Cbix2SPG.js" defer></script>
  </body>
</html>
